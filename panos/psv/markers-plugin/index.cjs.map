{"version":3,"sources":["src/index.ts","src/events.ts","src/MarkersButton.ts","src/icons/pin.svg","src/MarkersListButton.ts","src/constants.ts","src/icons/pin-list.svg","src/MarkersPlugin.ts","src/markers/AbstractStandardMarker.ts","src/MarkerType.ts","src/markers/AbstractDomMarker.ts","src/markers/Marker.ts","src/markers/MarkerNormal.ts","src/markers/Marker3D.ts","../shared/ChromaKeyMaterial.ts","../shared/shaders/chromaKey.fragment.glsl","../shared/shaders/chromaKey.vertex.glsl","../shared/video-utils.ts","src/utils.ts","src/markers/MarkerPolygon.ts","src/markers/MarkerSvg.ts"],"sourcesContent":["import { DEFAULTS, registerButton } from '@photo-sphere-viewer/core';\nimport * as events from './events';\nimport { MarkersButton } from './MarkersButton';\nimport { MarkersListButton } from './MarkersListButton';\n\nDEFAULTS.lang[MarkersButton.id] = 'Markers';\nDEFAULTS.lang[MarkersListButton.id] = 'Markers list';\nregisterButton(MarkersButton, 'caption:left');\nregisterButton(MarkersListButton, 'caption:left');\n\nexport type { Marker } from './markers/Marker';\nexport type { MarkerType } from './MarkerType';\nexport { MarkersPlugin } from './MarkersPlugin';\nexport * from './model';\nexport { events };\n\n/** @internal  */\nimport './style.scss';\n","import { TypedEvent } from '@photo-sphere-viewer/core';\nimport type { Marker } from './markers/Marker';\nimport type { MarkersPlugin } from './MarkersPlugin';\n\n/**\n * Base class for events dispatched by {@link MarkersPlugin}\n */\nexport abstract class MarkersPluginEvent extends TypedEvent<MarkersPlugin> {}\n\n/**\n * @event Triggered when the visibility of a marker changes\n */\nexport class MarkerVisibilityEvent extends MarkersPluginEvent {\n    static override readonly type = 'marker-visibility';\n    override type: 'marker-visibility';\n\n    /** @internal */\n    constructor(\n        public readonly marker: Marker,\n        public readonly visible: boolean\n    ) {\n        super(MarkerVisibilityEvent.type);\n    }\n}\n\n/**\n * @event Triggered when the animation to a marker is done\n */\nexport class GotoMarkerDoneEvent extends MarkersPluginEvent {\n    static override readonly type = 'goto-marker-done';\n    override type: 'goto-marker-done';\n\n    /** @internal */\n    constructor(public readonly marker: Marker) {\n        super(GotoMarkerDoneEvent.type);\n    }\n}\n\n/**\n * @event Triggered when the user puts the cursor away from a marker\n */\nexport class LeaveMarkerEvent extends MarkersPluginEvent {\n    static override readonly type = 'leave-marker';\n    override type: 'leave-marker';\n\n    /** @internal */\n    constructor(public readonly marker: Marker) {\n        super(LeaveMarkerEvent.type);\n    }\n}\n\n/**\n * @event Triggered when the user puts the cursor hover a marker\n */\nexport class EnterMarkerEvent extends MarkersPluginEvent {\n    static override readonly type = 'enter-marker';\n    override type: 'enter-marker';\n\n    /** @internal */\n    constructor(public readonly marker: Marker) {\n        super(EnterMarkerEvent.type);\n    }\n}\n\n/**\n * @event Triggered when the user clicks on a marker\n */\nexport class SelectMarkerEvent extends MarkersPluginEvent {\n    static override readonly type = 'select-marker';\n    override type: 'select-marker';\n\n    /** @internal */\n    constructor(\n        public readonly marker: Marker,\n        public readonly doubleClick: boolean,\n        public readonly rightClick: boolean\n    ) {\n        super(SelectMarkerEvent.type);\n    }\n}\n\n/**\n * @event Triggered when a marker is selected from the side panel\n */\nexport class SelectMarkerListEvent extends MarkersPluginEvent {\n    static override readonly type = 'select-marker-list';\n    override type: 'select-marker-list';\n\n    /** @internal */\n    constructor(public readonly marker: Marker) {\n        super(SelectMarkerListEvent.type);\n    }\n}\n\n/**\n * @event Triggered when a marker was selected and the user clicks elsewhere\n */\nexport class UnselectMarkerEvent extends MarkersPluginEvent {\n    static override readonly type = 'unselect-marker';\n    override type: 'unselect-marker';\n\n    /** @internal */\n    constructor(public readonly marker: Marker) {\n        super(UnselectMarkerEvent.type);\n    }\n}\n\n/**\n * @event Triggered when the markers are hidden\n */\nexport class HideMarkersEvent extends MarkersPluginEvent {\n    static override readonly type = 'hide-markers';\n    override type: 'hide-markers';\n\n    /** @internal */\n    constructor() {\n        super(HideMarkersEvent.type);\n    }\n}\n\n/**\n * @event Triggered when the markers change\n */\nexport class SetMarkersEvent extends MarkersPluginEvent {\n    static override readonly type = 'set-markers';\n    override type: 'set-markers';\n\n    /** @internal */\n    constructor(public readonly markers: Marker[]) {\n        super(SetMarkersEvent.type);\n    }\n}\n\n/**\n * @event Triggered when the markers are shown\n */\nexport class ShowMarkersEvent extends MarkersPluginEvent {\n    static override readonly type = 'show-markers';\n    override type: 'show-markers';\n\n    /** @internal */\n    constructor() {\n        super(ShowMarkersEvent.type);\n    }\n}\n\n/**\n * @event Used to alter the list of markers displayed in the side-panel\n */\nexport class RenderMarkersListEvent extends MarkersPluginEvent {\n    static override readonly type = 'render-markers-list';\n    override type: 'render-markers-list';\n\n    /** @internal */\n    constructor(\n        /** the list of markers to display, can be modified */\n        public markers: Marker[]\n    ) {\n        super(RenderMarkersListEvent.type);\n    }\n}\n\nexport type MarkersPluginEvents =\n    | MarkerVisibilityEvent\n    | GotoMarkerDoneEvent\n    | LeaveMarkerEvent\n    | EnterMarkerEvent\n    | SelectMarkerEvent\n    | SelectMarkerListEvent\n    | UnselectMarkerEvent\n    | HideMarkersEvent\n    | SetMarkersEvent\n    | ShowMarkersEvent\n    | RenderMarkersListEvent;\n","import type { Navbar } from '@photo-sphere-viewer/core';\nimport { AbstractButton } from '@photo-sphere-viewer/core';\nimport { HideMarkersEvent, ShowMarkersEvent } from './events';\nimport type { MarkersPlugin } from './MarkersPlugin';\nimport pin from './icons/pin.svg';\n\nexport class MarkersButton extends AbstractButton {\n    static override readonly id = 'markers';\n\n    private readonly plugin: MarkersPlugin;\n\n    constructor(navbar: Navbar) {\n        super(navbar, {\n            className: 'psv-markers-button',\n            icon: pin,\n            hoverScale: true,\n            collapsable: true,\n            tabbable: true,\n        });\n\n        this.plugin = this.viewer.getPlugin('markers');\n\n        if (this.plugin) {\n            this.plugin.addEventListener(ShowMarkersEvent.type, this);\n            this.plugin.addEventListener(HideMarkersEvent.type, this);\n\n            this.toggleActive(true);\n        }\n    }\n\n    override destroy() {\n        if (this.plugin) {\n            this.plugin.removeEventListener(ShowMarkersEvent.type, this);\n            this.plugin.removeEventListener(HideMarkersEvent.type, this);\n        }\n\n        super.destroy();\n    }\n\n    override isSupported() {\n        return !!this.plugin;\n    }\n\n    handleEvent(e: Event) {\n        if (e instanceof ShowMarkersEvent) {\n            this.toggleActive(true);\n        } else if (e instanceof HideMarkersEvent) {\n            this.toggleActive(false);\n        }\n    }\n\n    onClick() {\n        this.plugin.toggleAllMarkers();\n    }\n}\n","<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"10 9 81 81\"><path fill=\"currentColor\" d=\"M50.5 90S22.9 51.9 22.9 36.6 35.2 9 50.5 9s27.6 12.4 27.6 27.6S50.5 90 50.5 90zm0-66.3c-6.1 0-11 4.9-11 11s4.9 11 11 11 11-4.9 11-11-4.9-11-11-11z\"/><!--Created by Rohith M S from the Noun Project--></svg>\n","import type { Navbar } from '@photo-sphere-viewer/core';\nimport { AbstractButton, events } from '@photo-sphere-viewer/core';\nimport { ID_PANEL_MARKERS_LIST } from './constants';\nimport type { MarkersPlugin } from './MarkersPlugin';\nimport pinList from './icons/pin-list.svg';\n\nexport class MarkersListButton extends AbstractButton {\n    static override readonly id = 'markersList';\n\n    private readonly plugin: MarkersPlugin;\n\n    constructor(navbar: Navbar) {\n        super(navbar, {\n            className: ' psv-markers-list-button',\n            icon: pinList,\n            hoverScale: true,\n            collapsable: true,\n            tabbable: true,\n        });\n\n        this.plugin = this.viewer.getPlugin('markers');\n\n        if (this.plugin) {\n            this.viewer.addEventListener(events.ShowPanelEvent.type, this);\n            this.viewer.addEventListener(events.HidePanelEvent.type, this);\n        }\n    }\n\n    override destroy() {\n        this.viewer.removeEventListener(events.ShowPanelEvent.type, this);\n        this.viewer.removeEventListener(events.HidePanelEvent.type, this);\n\n        super.destroy();\n    }\n\n    override isSupported() {\n        return !!this.plugin;\n    }\n\n    handleEvent(e: Event) {\n        if (e instanceof events.ShowPanelEvent) {\n            this.toggleActive(e.panelId === ID_PANEL_MARKERS_LIST);\n        } else if (e instanceof events.HidePanelEvent) {\n            this.toggleActive(false);\n        }\n    }\n\n    onClick() {\n        this.plugin.toggleMarkersList();\n    }\n}\n","import { utils } from '@photo-sphere-viewer/core';\nimport type { Marker } from './markers/Marker';\nimport icon from './icons/pin-list.svg';\n\n/**\n * Namespace for SVG creation\n * @internal\n */\nexport const SVG_NS = 'http://www.w3.org/2000/svg';\n\n/**\n * Property name added to marker elements\n * @internal\n */\nexport const MARKER_DATA = 'psvMarker';\n\n/**\n * Property name added to marker elements (dash-case)\n * @internal\n */\nexport const MARKER_DATA_KEY = utils.dasherize(MARKER_DATA);\n\n/**\n * Panel identifier for marker content\n * @internal\n */\nexport const ID_PANEL_MARKER = 'marker';\n\n/**\n * Panel identifier for markers list\n * @internal\n */\nexport const ID_PANEL_MARKERS_LIST = 'markersList';\n\n/**\n * Default configuration for the \"hoverScale\" parameters\n * @internal\n */\nexport const DEFAULT_HOVER_SCALE = {\n    amount: 2,\n    duration: 100,\n    easing: 'linear',\n};\n\n/**\n * Markers list template\n * @internal\n */\nexport const MARKERS_LIST_TEMPLATE = (markers: Marker[], title: string) => `\n<div class=\"psv-panel-menu psv-panel-menu--stripped\">\n <h1 class=\"psv-panel-menu-title\">${icon} ${title}</h1>\n <ul class=\"psv-panel-menu-list\">\n   ${markers\n       .map(\n           (marker) => `\n   <li data-${MARKER_DATA_KEY}=\"${marker.id}\" class=\"psv-panel-menu-item\" tabindex=\"0\">\n     ${marker.type === 'image' ? `<span class=\"psv-panel-menu-item-icon\"><img src=\"${marker.definition}\"/></span>` : ''}\n     <span class=\"psv-panel-menu-item-label\">${marker.getListContent()}</span>\n   </li>\n   `\n       )\n       .join('')}\n </ul>\n</div>\n`;\n","<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"9 9 81 81\"><path fill=\"currentColor\" d=\"M37.5 90S9.9 51.9 9.9 36.6 22.2 9 37.5 9s27.6 12.4 27.6 27.6S37.5 90 37.5 90zm0-66.3c-6.1 0-11 4.9-11 11s4.9 11 11 11 11-4.9 11-11-4.9-11-11-11zM86.7 55H70c-1.8 0-3.3-1.5-3.3-3.3s1.5-3.3 3.3-3.3h16.7c1.8 0 3.3 1.5 3.3 3.3S88.5 55 86.7 55zm0-25h-15a3.3 3.3 0 0 1-3.3-3.3c0-1.8 1.5-3.3 3.3-3.3h15c1.8 0 3.3 1.5 3.3 3.3 0 1.8-1.5 3.3-3.3 3.3zM56.5 73h30c1.8 0 3.3 1.5 3.3 3.3 0 1.8-1.5 3.3-3.3 3.3h-30a3.3 3.3 0 0 1-3.3-3.3 3.2 3.2 0 0 1 3.3-3.3z\"/><!--Created by Rohith M S from the Noun Project--></svg>\n","import type { Point, Viewer } from '@photo-sphere-viewer/core';\nimport { AbstractConfigurablePlugin, PSVError, events, utils } from '@photo-sphere-viewer/core';\nimport { Object3D } from 'three';\nimport { MarkersButton } from './MarkersButton';\nimport { MarkersListButton } from './MarkersListButton';\nimport {\n    DEFAULT_HOVER_SCALE,\n    ID_PANEL_MARKER,\n    ID_PANEL_MARKERS_LIST,\n    MARKERS_LIST_TEMPLATE,\n    MARKER_DATA,\n    SVG_NS,\n} from './constants';\nimport {\n    EnterMarkerEvent,\n    GotoMarkerDoneEvent,\n    HideMarkersEvent,\n    LeaveMarkerEvent,\n    MarkerVisibilityEvent,\n    MarkersPluginEvents,\n    RenderMarkersListEvent,\n    SelectMarkerEvent,\n    SelectMarkerListEvent,\n    SetMarkersEvent,\n    ShowMarkersEvent,\n    UnselectMarkerEvent,\n} from './events';\nimport { AbstractStandardMarker } from './markers/AbstractStandardMarker';\nimport { Marker } from './markers/Marker';\nimport { getMarkerType } from './MarkerType';\nimport { MarkerConfig, MarkersPluginConfig, ParsedMarkersPluginConfig, UpdatableMarkersPluginConfig } from './model';\nimport { MarkerNormal } from './markers/MarkerNormal';\nimport { Marker3D } from './markers/Marker3D';\nimport { MarkerPolygon } from './markers/MarkerPolygon';\nimport { MarkerSvg } from './markers/MarkerSvg';\n\nconst getConfig = utils.getConfigParser<MarkersPluginConfig, ParsedMarkersPluginConfig>(\n    {\n        clickEventOnMarker: false,\n        gotoMarkerSpeed: '8rpm',\n        markers: null,\n        defaultHoverScale: null,\n    },\n    {\n        defaultHoverScale(defaultHoverScale) {\n            if (!defaultHoverScale) {\n                return null;\n            }\n            if (defaultHoverScale === true) {\n                defaultHoverScale = DEFAULT_HOVER_SCALE;\n            }\n            if (typeof defaultHoverScale === 'number') {\n                defaultHoverScale = { amount: defaultHoverScale };\n            }\n            return {\n                ...DEFAULT_HOVER_SCALE,\n                ...defaultHoverScale,\n            };\n        },\n    }\n);\n\nfunction getMarkerCtor(config: MarkerConfig): typeof Marker {\n    const type = getMarkerType(config, false);\n\n    switch (type) {\n        case 'image':\n        case 'html':\n        case 'element':\n            return MarkerNormal;\n        case 'imageLayer':\n        case 'videoLayer':\n            return Marker3D;\n        case 'polygon':\n        case 'polyline':\n        case 'polygonPixels':\n        case 'polylinePixels':\n            return MarkerPolygon;\n        case 'square':\n        case 'rect':\n        case 'circle':\n        case 'ellipse':\n        case 'path':\n            return MarkerSvg;\n        default:\n            throw new PSVError('invalid marker type');\n    }\n}\n\n/**\n * Displays various markers on the viewer\n */\nexport class MarkersPlugin extends AbstractConfigurablePlugin<\n    MarkersPluginConfig,\n    ParsedMarkersPluginConfig,\n    UpdatableMarkersPluginConfig,\n    MarkersPluginEvents\n> {\n    static override readonly id = 'markers';\n    static override readonly VERSION = PKG_VERSION;\n    static override readonly configParser = getConfig;\n    static override readonly readonlyOptions: Array<keyof MarkersPluginConfig> = ['markers'];\n\n    private readonly markers: Record<string, Marker> = {};\n\n    private readonly state = {\n        visible: true,\n        showAllTooltips: false,\n        currentMarker: null as Marker,\n        hoveringMarker: null as Marker,\n        // require a 2nd render (only the scene) when 3d markers visibility changes\n        needsReRender: false,\n    };\n\n    private readonly container: HTMLElement;\n    private readonly svgContainer: SVGElement;\n\n    constructor(viewer: Viewer, config: MarkersPluginConfig) {\n        super(viewer, config);\n\n        this.container = document.createElement('div');\n        this.container.className = 'psv-markers';\n        this.viewer.container.appendChild(this.container);\n\n        this.svgContainer = document.createElementNS(SVG_NS, 'svg');\n        this.svgContainer.setAttribute('class', 'psv-markers-svg-container');\n        this.container.appendChild(this.svgContainer);\n\n        // Markers events via delegation\n        this.container.addEventListener('mouseenter', this, true);\n        this.container.addEventListener('mouseleave', this, true);\n        this.container.addEventListener('mousemove', this, true);\n        this.container.addEventListener('contextmenu', this);\n    }\n\n    /**\n     * @internal\n     */\n    override init() {\n        super.init();\n\n        utils.checkStylesheet(this.viewer.container, 'markers-plugin');\n\n        // Viewer events\n        this.viewer.addEventListener(events.ClickEvent.type, this);\n        this.viewer.addEventListener(events.DoubleClickEvent.type, this);\n        this.viewer.addEventListener(events.RenderEvent.type, this);\n        this.viewer.addEventListener(events.ConfigChangedEvent.type, this);\n        this.viewer.addEventListener(events.ObjectEnterEvent.type, this);\n        this.viewer.addEventListener(events.ObjectHoverEvent.type, this);\n        this.viewer.addEventListener(events.ObjectLeaveEvent.type, this);\n        this.viewer.addEventListener(events.ReadyEvent.type, this, { once: true });\n    }\n\n    /**\n     * @internal\n     */\n    override destroy() {\n        this.clearMarkers(false);\n\n        this.viewer.unobserveObjects(MARKER_DATA);\n\n        this.viewer.removeEventListener(events.ClickEvent.type, this);\n        this.viewer.removeEventListener(events.DoubleClickEvent.type, this);\n        this.viewer.removeEventListener(events.RenderEvent.type, this);\n        this.viewer.removeEventListener(events.ObjectEnterEvent.type, this);\n        this.viewer.removeEventListener(events.ObjectHoverEvent.type, this);\n        this.viewer.removeEventListener(events.ObjectLeaveEvent.type, this);\n        this.viewer.removeEventListener(events.ReadyEvent.type, this);\n\n        this.viewer.container.removeChild(this.container);\n\n        super.destroy();\n    }\n\n    /**\n     * @internal\n     */\n    handleEvent(e: Event) {\n        switch (e.type) {\n            case events.ReadyEvent.type:\n                if (this.config.markers) {\n                    this.setMarkers(this.config.markers);\n                    delete this.config.markers;\n                }\n                break;\n\n            case events.RenderEvent.type:\n                this.renderMarkers();\n                break;\n\n            case events.ClickEvent.type:\n                this.__onClick(e as events.ClickEvent, false);\n                break;\n\n            case events.DoubleClickEvent.type:\n                this.__onClick(e as events.DoubleClickEvent, true);\n                break;\n\n            case events.ObjectEnterEvent.type:\n            case events.ObjectLeaveEvent.type:\n            case events.ObjectHoverEvent.type:\n                if ((e as events.ObjectEvent).userDataKey === MARKER_DATA) {\n                    const event = (e as events.ObjectEvent).originalEvent;\n                    const marker: Marker = (e as events.ObjectEvent).object.userData[MARKER_DATA];\n                    switch (e.type) {\n                        case events.ObjectEnterEvent.type:\n                            if (marker.config.style?.cursor) {\n                                this.viewer.setCursor(marker.config.style.cursor);\n                            } else if (marker.config.tooltip || marker.config.content) {\n                                this.viewer.setCursor('pointer');\n                            }\n                            this.__onEnterMarker(event, marker);\n                            break;\n                        case events.ObjectLeaveEvent.type:\n                            this.viewer.setCursor(null);\n                            this.__onLeaveMarker(marker);\n                            break;\n                        case events.ObjectHoverEvent.type:\n                            this.__onHoverMarker(event, marker);\n                            break;\n                    }\n                }\n                break;\n\n            case 'mouseenter':\n                this.__onEnterMarker(e as MouseEvent, this.__getTargetMarker(e.target as HTMLElement));\n                break;\n\n            case 'mouseleave':\n                this.__onLeaveMarker(this.__getTargetMarker(e.target as HTMLElement));\n                break;\n\n            case 'mousemove':\n                this.__onHoverMarker(e as MouseEvent, this.__getTargetMarker(e.target as HTMLElement, true));\n                break;\n\n            case 'contextmenu':\n                e.preventDefault();\n                break;\n        }\n    }\n\n    /**\n     * Toggles all markers\n     */\n    toggleAllMarkers() {\n        if (this.state.visible) {\n            this.hideAllMarkers();\n        } else {\n            this.showAllMarkers();\n        }\n    }\n\n    /**\n     * Shows all markers\n     */\n    showAllMarkers() {\n        this.state.visible = true;\n        this.renderMarkers();\n        this.dispatchEvent(new ShowMarkersEvent());\n    }\n\n    /**\n     * Hides all markers\n     */\n    hideAllMarkers() {\n        this.state.visible = false;\n        this.renderMarkers();\n        this.dispatchEvent(new HideMarkersEvent());\n    }\n\n    /**\n     * Toggles the visibility of all tooltips\n     */\n    toggleAllTooltips() {\n        if (this.state.showAllTooltips) {\n            this.hideAllTooltips();\n        } else {\n            this.showAllTooltips();\n        }\n    }\n\n    /**\n     *  Displays all tooltips\n     */\n    showAllTooltips() {\n        this.state.showAllTooltips = true;\n        Object.values(this.markers).forEach((marker) => {\n            marker.state.staticTooltip = true;\n            marker.showTooltip();\n        });\n    }\n\n    /**\n     * Hides all tooltips\n     */\n    hideAllTooltips() {\n        this.state.showAllTooltips = false;\n        Object.values(this.markers).forEach((marker) => {\n            marker.state.staticTooltip = false;\n            marker.hideTooltip();\n        });\n    }\n\n    /**\n     * Returns the total number of markers\n     */\n    getNbMarkers(): number {\n        return Object.keys(this.markers).length;\n    }\n\n    /**\n     * Returns all the markers\n     */\n    getMarkers(): Marker[] {\n        return Object.values(this.markers);\n    }\n\n    /**\n     * Adds a new marker to viewer\n     * @throws {@link PSVError} when the marker's id is missing or already exists\n     */\n    addMarker(config: MarkerConfig, render = true) {\n        if (this.markers[config.id]) {\n            throw new PSVError(`marker \"${config.id}\" already exists`);\n        }\n\n        // @ts-ignore\n        const marker = new (getMarkerCtor(config))(this.viewer, this, config);\n\n        if (marker.isPoly()) {\n            this.svgContainer.appendChild(marker.domElement);\n        } else if (marker.is3d()) {\n            this.viewer.renderer.addObject(marker.threeElement);\n        } else {\n            this.container.appendChild(marker.domElement);\n        }\n\n        this.markers[marker.id] = marker;\n\n        if (this.state.showAllTooltips) {\n            marker.state.staticTooltip = true;\n        }\n\n        if (render) {\n            this.__afterChangerMarkers();\n        }\n    }\n\n    /**\n     * Returns the internal marker object for a marker id\n     * @throws {@link PSVError} when the marker cannot be found\n     */\n    getMarker(markerId: string | MarkerConfig): Marker {\n        const id = typeof markerId === 'object' ? markerId.id : markerId;\n\n        if (!this.markers[id]) {\n            throw new PSVError(`cannot find marker \"${id}\"`);\n        }\n\n        return this.markers[id];\n    }\n\n    /**\n     * Returns the last marker selected by the user\n     */\n    getCurrentMarker(): Marker {\n        return this.state.currentMarker;\n    }\n\n    /**\n     * Updates the existing marker with the same id\n     * @description Every property can be changed but you can't change its type (Eg: `image` to `html`)\n     */\n    updateMarker(config: MarkerConfig, render = true) {\n        const marker = this.getMarker(config.id);\n\n        marker.update(config);\n\n        if (render) {\n            this.__afterChangerMarkers();\n\n            if (\n                (marker === this.state.hoveringMarker && marker.config.tooltip?.trigger === 'hover')\n                || marker.state.staticTooltip\n            ) {\n                marker.showTooltip();\n            }\n        }\n    }\n\n    /**\n     * Removes a marker from the viewer\n     */\n    removeMarker(markerId: string | MarkerConfig, render = true) {\n        const marker = this.getMarker(markerId);\n\n        if (marker.isPoly()) {\n            this.svgContainer.removeChild(marker.domElement);\n        } else if (marker.is3d()) {\n            this.viewer.renderer.removeObject(marker.threeElement);\n        } else {\n            this.container.removeChild(marker.domElement);\n        }\n\n        if (this.state.hoveringMarker === marker) {\n            this.state.hoveringMarker = null;\n        }\n\n        if (this.state.currentMarker === marker) {\n            this.state.currentMarker = null;\n        }\n\n        marker.destroy();\n        delete this.markers[marker.id];\n\n        if (render) {\n            this.__afterChangerMarkers();\n        }\n    }\n\n    /**\n     * Removes multiple markers\n     */\n    removeMarkers(markerIds: string[], render = true) {\n        markerIds.forEach((markerId) => this.removeMarker(markerId, false));\n\n        if (render) {\n            this.__afterChangerMarkers();\n        }\n    }\n\n    /**\n     * Replaces all markers\n     */\n    setMarkers(markers: MarkerConfig[], render = true) {\n        this.clearMarkers(false);\n\n        markers?.forEach((marker) => {\n            this.addMarker(marker, false);\n        });\n\n        if (render) {\n            this.__afterChangerMarkers();\n        }\n    }\n\n    /**\n     * Removes all markers\n     */\n    clearMarkers(render = true) {\n        Object.keys(this.markers).forEach((markerId) => {\n            this.removeMarker(markerId, false);\n        });\n\n        if (render) {\n            this.__afterChangerMarkers();\n        }\n    }\n\n    /**\n     * Rotate the view to face the marker\n     */\n    gotoMarker(markerId: string | MarkerConfig, speed: string | number = this.config.gotoMarkerSpeed): Promise<void> {\n        const marker = this.getMarker(markerId);\n\n        if (!speed) {\n            this.viewer.rotate(marker.state.position);\n            if (!utils.isNil(marker.config.zoomLvl)) {\n                this.viewer.zoom(marker.config.zoomLvl);\n            }\n            this.dispatchEvent(new GotoMarkerDoneEvent(marker));\n            return Promise.resolve();\n        } else {\n            return this.viewer\n                .animate({\n                    ...marker.state.position,\n                    zoom: marker.config.zoomLvl,\n                    speed: speed,\n                })\n                .then(() => {\n                    this.dispatchEvent(new GotoMarkerDoneEvent(marker));\n                });\n        }\n    }\n\n    /**\n     * Hides a marker\n     */\n    hideMarker(markerId: string | MarkerConfig) {\n        this.toggleMarker(markerId, false);\n    }\n\n    /**\n     * Shows a marker\n     */\n    showMarker(markerId: string | MarkerConfig) {\n        this.toggleMarker(markerId, true);\n    }\n\n    /**\n     * Forces the display of the tooltip of a marker\n     */\n    showMarkerTooltip(markerId: string | MarkerConfig) {\n        const marker = this.getMarker(markerId);\n        marker.state.staticTooltip = true;\n        marker.showTooltip();\n    }\n\n    /**\n     * Hides the tooltip of a marker\n     */\n    hideMarkerTooltip(markerId: string | MarkerConfig) {\n        const marker = this.getMarker(markerId);\n        marker.state.staticTooltip = false;\n        marker.hideTooltip();\n    }\n\n    /**\n     * Toggles a marker visibility\n     */\n    toggleMarker(markerId: string | MarkerConfig, visible?: boolean) {\n        const marker = this.getMarker(markerId);\n        marker.config.visible = utils.isNil(visible) ? !marker.config.visible : visible;\n        this.renderMarkers();\n    }\n\n    /**\n     * Opens the panel with the content of the marker\n     */\n    showMarkerPanel(markerId: string | MarkerConfig) {\n        const marker = this.getMarker(markerId);\n\n        if (marker.config.content) {\n            this.viewer.panel.show({\n                id: ID_PANEL_MARKER,\n                content: marker.config.content,\n            });\n        } else {\n            this.hideMarkerPanel();\n        }\n    }\n\n    /**\n     * Closes the panel if currently showing the content of a marker\n     */\n    hideMarkerPanel() {\n        this.viewer.panel.hide(ID_PANEL_MARKER);\n    }\n\n    /**\n     * Toggles the visibility of the list of markers\n     */\n    toggleMarkersList() {\n        if (this.viewer.panel.isVisible(ID_PANEL_MARKERS_LIST)) {\n            this.hideMarkersList();\n        } else {\n            this.showMarkersList();\n        }\n    }\n\n    /**\n     * Opens side panel with the list of markers\n     */\n    showMarkersList() {\n        let markers: Marker[] = [];\n        if (this.state.visible) {\n            Object.values(this.markers).forEach((marker) => {\n                if (marker.config.visible && !marker.config.hideList) {\n                    markers.push(marker);\n                }\n            });\n        }\n\n        const e = new RenderMarkersListEvent(markers);\n        this.dispatchEvent(e);\n        markers = e.markers;\n\n        this.viewer.panel.show({\n            id: ID_PANEL_MARKERS_LIST,\n            content: MARKERS_LIST_TEMPLATE(markers, this.viewer.config.lang[MarkersButton.id]),\n            noMargin: true,\n            clickHandler: (target) => {\n                const li = utils.getClosest(target, 'li');\n                const markerId = li ? li.dataset[MARKER_DATA] : undefined;\n\n                if (markerId) {\n                    const marker = this.getMarker(markerId);\n\n                    this.dispatchEvent(new SelectMarkerListEvent(marker));\n\n                    this.gotoMarker(marker.id);\n                    this.hideMarkersList();\n                }\n            },\n        });\n    }\n\n    /**\n     * Closes side panel if it contains the list of markers\n     */\n    hideMarkersList() {\n        this.viewer.panel.hide(ID_PANEL_MARKERS_LIST);\n    }\n\n    /**\n     * Updates the visibility and the position of all markers\n     */\n    renderMarkers() {\n        if (this.state.needsReRender) {\n            this.state.needsReRender = false;\n            return;\n        }\n\n        const zoomLevel = this.viewer.getZoomLevel();\n        const viewerPosition = this.viewer.getPosition();\n        const hoveringMarker = this.state.hoveringMarker;\n\n        Object.values(this.markers).forEach((marker) => {\n            let isVisible = this.state.visible && marker.config.visible;\n            let visibilityChanged = false;\n            let position: Point = null;\n\n            if (isVisible) {\n                position = marker.render({ viewerPosition, zoomLevel, hoveringMarker });\n                isVisible = !!position;\n            }\n\n            visibilityChanged = marker.state.visible !== isVisible;\n            marker.state.visible = isVisible;\n            marker.state.position2D = position;\n\n            if (!marker.is3d()) {\n                utils.toggleClass(marker.domElement, 'psv-marker--visible', isVisible);\n            }\n\n            if (!isVisible) {\n                marker.hideTooltip();\n            } else if (marker.state.staticTooltip) {\n                marker.showTooltip();\n            } else if (marker !== this.state.hoveringMarker) {\n                marker.hideTooltip();\n            }\n\n            if (visibilityChanged) {\n                this.dispatchEvent(new MarkerVisibilityEvent(marker, isVisible));\n\n                if (marker.is3d()) {\n                    this.state.needsReRender = true;\n                }\n            }\n        });\n\n        if (this.state.needsReRender) {\n            this.viewer.needsUpdate();\n        }\n    }\n\n    /**\n     * Returns the marker associated to an event target\n     */\n    private __getTargetMarker(target: HTMLElement, closest?: boolean): Marker;\n    private __getTargetMarker(target: Object3D[]): Marker;\n    private __getTargetMarker(target: HTMLElement | Object3D[], closest = false): Marker {\n        if (target instanceof Node) {\n            const target2 = closest ? utils.getClosest(target, '.psv-marker') : target;\n            return target2 ? (target2 as any)[MARKER_DATA] : undefined;\n        } else if (Array.isArray(target)) {\n            return target\n                .map((o) => o.userData[MARKER_DATA] as Marker)\n                .filter((m) => !!m)\n                .sort((a, b) => b.config.zIndex - a.config.zIndex)[0];\n        } else {\n            return null;\n        }\n    }\n\n    /**\n     * Handles mouse enter events, show the tooltip for non polygon markers\n     */\n    private __onEnterMarker(e: MouseEvent, marker?: Marker) {\n        if (marker) {\n            this.state.hoveringMarker = marker;\n\n            this.dispatchEvent(new EnterMarkerEvent(marker));\n\n            if (marker instanceof AbstractStandardMarker) {\n                marker.applyScale({\n                    zoomLevel: this.viewer.getZoomLevel(),\n                    viewerPosition: this.viewer.getPosition(),\n                    mouseover: true,\n                });\n            }\n\n            if (!marker.state.staticTooltip && marker.config.tooltip?.trigger === 'hover') {\n                marker.showTooltip(e.clientX, e.clientY);\n            }\n        }\n    }\n\n    /**\n     * Handles mouse leave events, hide the tooltip\n     */\n    private __onLeaveMarker(marker?: Marker) {\n        if (marker) {\n            this.dispatchEvent(new LeaveMarkerEvent(marker));\n\n            if (marker instanceof AbstractStandardMarker) {\n                marker.applyScale({\n                    zoomLevel: this.viewer.getZoomLevel(),\n                    viewerPosition: this.viewer.getPosition(),\n                    mouseover: false,\n                });\n            }\n\n            this.state.hoveringMarker = null;\n\n            if (!marker.state.staticTooltip && marker.config.tooltip?.trigger === 'hover') {\n                marker.hideTooltip();\n            } else if (marker.state.staticTooltip) {\n                marker.showTooltip();\n            }\n        }\n    }\n\n    /**\n     * Handles mouse move events, refresh the tooltip for polygon markers\n     */\n    private __onHoverMarker(e: MouseEvent, marker?: Marker) {\n        if (marker && (marker.isPoly() || marker.is3d())) {\n            if (marker.config.tooltip?.trigger === 'hover') {\n                marker.showTooltip(e.clientX, e.clientY);\n            }\n        }\n    }\n\n    /**\n     * Handles mouse click events, select the marker and open the panel if necessary\n     */\n    private __onClick(e: events.ClickEvent | events.DoubleClickEvent, dblclick: boolean) {\n        const threeMarker = this.__getTargetMarker(e.data.objects);\n        const stdMarker = this.__getTargetMarker(e.data.target, true);\n\n        // give priority to standard markers which are always on top of Three markers\n        const marker = stdMarker || threeMarker;\n\n        if (this.state.currentMarker && this.state.currentMarker !== marker) {\n            this.dispatchEvent(new UnselectMarkerEvent(this.state.currentMarker));\n\n            this.viewer.panel.hide(ID_PANEL_MARKER);\n\n            if (!this.state.showAllTooltips && this.state.currentMarker.config.tooltip?.trigger === 'click') {\n                this.hideMarkerTooltip(this.state.currentMarker.id);\n            }\n\n            this.state.currentMarker = null;\n        }\n\n        if (marker) {\n            this.state.currentMarker = marker;\n\n            this.dispatchEvent(new SelectMarkerEvent(marker, dblclick, e.data.rightclick));\n\n            if (this.config.clickEventOnMarker) {\n                // add the marker to event data\n                e.data.marker = marker;\n            } else {\n                e.stopImmediatePropagation();\n            }\n\n            // the marker could have been deleted in an event handler\n            if (this.markers[marker.id]) {\n                if (marker.config.tooltip?.trigger === 'click') {\n                    if (marker.tooltip) {\n                        this.hideMarkerTooltip(marker.id);\n                    } else {\n                        this.showMarkerTooltip(marker.id);\n                    }\n                } else {\n                    this.showMarkerPanel(marker.id);\n                }\n            }\n        }\n    }\n\n    private __afterChangerMarkers() {\n        this.__refreshUi();\n        this.__checkObjectsObserver();\n        this.viewer.needsUpdate();\n        this.dispatchEvent(new SetMarkersEvent(this.getMarkers()));\n    }\n\n    /**\n     * Updates the visiblity of the panel and the buttons\n     */\n    private __refreshUi() {\n        const nbMarkers = Object.values(this.markers).filter((m) => !m.config.hideList).length;\n\n        if (nbMarkers === 0) {\n            if (this.viewer.panel.isVisible(ID_PANEL_MARKERS_LIST) || this.viewer.panel.isVisible(ID_PANEL_MARKER)) {\n                this.viewer.panel.hide();\n            }\n        } else {\n            if (this.viewer.panel.isVisible(ID_PANEL_MARKERS_LIST)) {\n                this.showMarkersList();\n            } else if (this.viewer.panel.isVisible(ID_PANEL_MARKER)) {\n                this.state.currentMarker ? this.showMarkerPanel(this.state.currentMarker.id) : this.viewer.panel.hide();\n            }\n        }\n\n        this.viewer.navbar.getButton(MarkersButton.id, false)?.toggle(nbMarkers > 0);\n        this.viewer.navbar.getButton(MarkersListButton.id, false)?.toggle(nbMarkers > 0);\n    }\n\n    /**\n     * Adds or remove the objects observer if there are 3D markers\n     */\n    private __checkObjectsObserver() {\n        const has3d = Object.values(this.markers).some((marker) => marker.is3d());\n\n        if (has3d) {\n            this.viewer.observeObjects(MARKER_DATA);\n        } else {\n            this.viewer.unobserveObjects(MARKER_DATA);\n        }\n    }\n}\n","import { CONSTANTS, Point, Position, utils, type Viewer } from '@photo-sphere-viewer/core';\nimport { MathUtils } from 'three';\nimport { DEFAULT_HOVER_SCALE, MARKER_DATA } from '../constants';\nimport { type MarkersPlugin } from '../MarkersPlugin';\nimport { MarkerType } from '../MarkerType';\nimport { MarkerConfig } from '../model';\nimport { AbstractDomMarker } from './AbstractDomMarker';\nimport { Marker } from './Marker';\n\n/**\n * Base class for standard markers (all but 3d and poly)\n * @internal\n */\nexport abstract class AbstractStandardMarker extends AbstractDomMarker {\n    constructor(viewer: Viewer, plugin: MarkersPlugin, config: MarkerConfig) {\n        super(viewer, plugin, config);\n    }\n\n    override createElement(): void {\n        this.element[MARKER_DATA] = this;\n\n        this.domElement.addEventListener('transitionend', () => {\n            // the transition \"scale\" is only applied manually on mouseover\n            // because it must not be present when the scale changes on zoom/move\n            this.domElement.style.transition = '';\n        });\n    }\n\n    override render({\n        viewerPosition,\n        zoomLevel,\n        hoveringMarker,\n    }: {\n        viewerPosition: Position;\n        zoomLevel: number;\n        hoveringMarker: Marker;\n    }): Point {\n        this.__updateSize();\n\n        const position = this.viewer.dataHelper.vector3ToViewerCoords(this.state.positions3D[0]);\n        position.x -= this.state.size.width * this.state.anchor.x;\n        position.y -= this.state.size.height * this.state.anchor.y;\n\n        // It tests if the point is in the general direction of the camera, then check if it's in the viewport\n        const isVisible = (\n            this.state.positions3D[0].dot(this.viewer.state.direction) > 0\n            && position.x + this.state.size.width >= 0\n            && position.x - this.state.size.width <= this.viewer.state.size.width\n            && position.y + this.state.size.height >= 0\n            && position.y - this.state.size.height <= this.viewer.state.size.height\n        );\n\n        if (isVisible) {\n            this.domElement.style.translate = `${position.x}px ${position.y}px 0px`;\n\n            this.applyScale({\n                zoomLevel,\n                viewerPosition,\n                mouseover: this === hoveringMarker,\n            });\n\n            if (this.type === MarkerType.element) {\n                this.config.element.updateMarker?.({\n                    marker: this,\n                    position,\n                    viewerPosition,\n                    zoomLevel,\n                    viewerSize: this.viewer.state.size,\n                });\n            }\n\n            return position;\n        } else {\n            return null;\n        }\n    }\n\n    override update(config: MarkerConfig): void {\n        super.update(config);\n\n        const element = this.domElement;\n\n        element.classList.add('psv-marker--normal');\n\n        if (this.config.scale && Array.isArray(this.config.scale)) {\n            this.config.scale = { zoom: this.config.scale as any };\n        }\n        if (typeof this.config.hoverScale === 'boolean') {\n            this.config.hoverScale = this.config.hoverScale\n                ? this.plugin.config.defaultHoverScale || DEFAULT_HOVER_SCALE\n                : null;\n        } else if (typeof this.config.hoverScale === 'number') {\n            this.config.hoverScale = { amount: this.config.hoverScale } as any;\n        } else if (!this.config.hoverScale) {\n            this.config.hoverScale = this.plugin.config.defaultHoverScale;\n        }\n        if (this.config.hoverScale) {\n            this.config.hoverScale = {\n                ...DEFAULT_HOVER_SCALE,\n                ...this.plugin.config.defaultHoverScale,\n                ...this.config.hoverScale,\n            };\n        }\n\n        element.style.rotate = this.config.rotation !== 0 ? MathUtils.radToDeg(this.config.rotation) + 'deg' : null;\n    }\n\n    /**\n     * Computes the real size of a marker\n     * @description This is done by removing all it's transformations (if any) and making it visible\n     * before querying its bounding rect\n     */\n    private __updateSize() {\n        if (!this.state.dynamicSize) {\n            return;\n        }\n\n        const element = this.domElement;\n        const init = !this.state.size;\n\n        if (init) {\n            element.classList.add('psv-marker--transparent');\n        }\n\n        if (this.isSvg()) {\n            const rect = (element.firstElementChild as SVGElement).getBoundingClientRect();\n            this.state.size = {\n                width: rect.width,\n                height: rect.height,\n            };\n        } else if (this.isNormal()) {\n            this.state.size = {\n                width: (element as HTMLElement).offsetWidth,\n                height: (element as HTMLElement).offsetHeight,\n            };\n        }\n\n        if (init) {\n            element.classList.remove('psv-marker--transparent');\n        }\n\n        if (this.isSvg()) {\n            // the real size must be declared on the SVG root\n            element.style.width = this.state.size.width + 'px';\n            element.style.height = this.state.size.height + 'px';\n        }\n\n        // custom element HTML marker remain dynamic\n        if (this.type !== MarkerType.element) {\n            this.state.dynamicSize = false;\n        }\n    }\n\n    /**\n     * Computes and applies the scale to the marker\n     */\n    applyScale({\n        zoomLevel,\n        viewerPosition,\n        mouseover,\n    }: {\n        zoomLevel: number;\n        viewerPosition: Position;\n        mouseover: boolean;\n    }) {\n        if (mouseover !== null && this.config.hoverScale) {\n            this.domElement.style.transition = `scale ${this.config.hoverScale.duration}ms ${this.config.hoverScale.easing}`;\n        }\n\n        let scale = 1;\n        if (typeof this.config.scale === 'function') {\n            scale = this.config.scale(zoomLevel, viewerPosition);\n        } else if (this.config.scale) {\n            if (Array.isArray(this.config.scale.zoom)) {\n                const [min, max] = this.config.scale.zoom;\n                scale *= min + (max - min) * CONSTANTS.EASINGS.inQuad(zoomLevel / 100);\n            }\n            if (Array.isArray(this.config.scale.yaw)) {\n                const [min, max] = this.config.scale.yaw;\n                const halfFov = MathUtils.degToRad(this.viewer.state.hFov) / 2;\n                const arc = Math.abs(utils.getShortestArc(this.state.position.yaw, viewerPosition.yaw));\n                scale *= max + (min - max) * CONSTANTS.EASINGS.outQuad(Math.max(0, (halfFov - arc) / halfFov));\n            }\n        }\n        if (mouseover && this.config.hoverScale) {\n            scale *= this.config.hoverScale.amount;\n        }\n\n        this.domElement.style.scale = `${scale}`;\n    }\n}\n","import { PSVError } from '@photo-sphere-viewer/core';\nimport { MarkerConfig } from './model';\n\nexport enum MarkerType {\n    image = 'image',\n    html = 'html',\n    element = 'element',\n    imageLayer = 'imageLayer',\n    videoLayer = 'videoLayer',\n    polygon = 'polygon',\n    polygonPixels = 'polygonPixels',\n    polyline = 'polyline',\n    polylinePixels = 'polylinePixels',\n    square = 'square',\n    rect = 'rect',\n    circle = 'circle',\n    ellipse = 'ellipse',\n    path = 'path',\n}\n\n/**\n * Determines the type of a marker by the available properties\n * @throws {@link PSVError} when the marker's type cannot be found\n */\nexport function getMarkerType(config: MarkerConfig, allowNone = false): MarkerType {\n    const found: MarkerType[] = [];\n\n    Object.keys(MarkerType).forEach((type) => {\n        if ((config as any)[type]) {\n            found.push(type as MarkerType);\n        }\n    });\n\n    if (found.length === 0 && !allowNone) {\n        throw new PSVError(`missing marker content, either ${Object.keys(MarkerType).join(', ')}`);\n    } else if (found.length > 1) {\n        throw new PSVError(`multiple marker content, either ${Object.keys(MarkerType).join(', ')}`);\n    }\n\n    return found[0];\n}\n","import { utils, type Viewer } from '@photo-sphere-viewer/core';\nimport { MARKER_DATA } from '../constants';\nimport { type MarkersPlugin } from '../MarkersPlugin';\nimport { MarkerConfig } from '../model';\nimport { Marker } from './Marker';\n\n/**\n * Base class for markers added in the DOM (all by 3d)\n * @internal\n */\nexport abstract class AbstractDomMarker extends Marker {\n    override get domElement(): HTMLElement | SVGElement {\n        return this.element;\n    }\n\n    constructor(viewer: Viewer, plugin: MarkersPlugin, config: MarkerConfig) {\n        super(viewer, plugin, config);\n    }\n\n    override destroy(): void {\n        delete this.element[MARKER_DATA];\n\n        super.destroy();\n    }\n\n    override update(config: MarkerConfig): void {\n        super.update(config);\n\n        const element = this.domElement;\n\n        element.id = `psv-marker-${this.config.id}`;\n\n        // reset CSS class\n        element.setAttribute('class', 'psv-marker');\n        if (this.state.visible) {\n            element.classList.add('psv-marker--visible');\n        }\n        if (this.config.tooltip) {\n            element.classList.add('psv-marker--has-tooltip');\n        }\n        if (this.config.content) {\n            element.classList.add('psv-marker--has-content');\n        }\n        if (this.config.className) {\n            utils.addClasses(element, this.config.className);\n        }\n\n        // apply style\n        element.style.opacity = `${this.config.opacity}`;\n        element.style.zIndex = `${30 + this.config.zIndex}`; // 30 is the base z-index in the stylesheet\n        if (this.config.style) {\n            Object.assign(element.style, this.config.style);\n        }\n    }\n}\n","import { PSVError, Point, Position, Size, Tooltip, TooltipConfig, utils, type Viewer } from '@photo-sphere-viewer/core';\nimport { Group, Vector3 } from 'three';\nimport { MarkerType, getMarkerType } from '../MarkerType';\nimport { type MarkersPlugin } from '../MarkersPlugin';\nimport { MarkerConfig, ParsedMarkerConfig } from '../model';\n\n/**\n * Base class for all markers\n */\nexport abstract class Marker {\n    readonly type: MarkerType;\n\n    protected element: any;\n\n    /**\n     * The final description of the marker. Either text content, image, url, SVG attributes, etc.\n     */\n    definition: any;\n\n    /** @internal */\n    tooltip?: Tooltip;\n\n    config: ParsedMarkerConfig;\n\n    get id(): string {\n        return this.config.id;\n    }\n\n    get data(): any {\n        return this.config.data;\n    }\n\n    get domElement(): HTMLElement | SVGElement {\n        return null;\n    }\n\n    get threeElement(): Group {\n        return null;\n    }\n\n    get video(): HTMLVideoElement {\n        return null;\n    }\n\n    /** @internal */\n    readonly state = {\n        dynamicSize: false,\n        anchor: null as Point,\n        visible: false,\n        staticTooltip: false,\n        position: null as Position,\n        position2D: null as Point,\n        positions3D: null as Vector3[],\n        size: null as Size,\n    };\n\n    constructor(\n        protected viewer: Viewer,\n        protected plugin: MarkersPlugin,\n        config: MarkerConfig\n    ) {\n        if (!config.id) {\n            throw new PSVError('missing marker id');\n        }\n\n        this.type = getMarkerType(config);\n        this.createElement();\n        this.update(config);\n    }\n\n    /**\n     * @internal\n     */\n    abstract createElement(): void;\n\n    /**\n     * @internal\n     */\n    abstract render(params: {\n        viewerPosition: Position;\n        zoomLevel: number;\n        hoveringMarker: Marker;\n    }): Point;\n\n    /**\n     * @internal\n     */\n    destroy() {\n        delete this.viewer;\n        delete this.plugin;\n\n        this.hideTooltip();\n    }\n\n    /**\n     * Checks if it is a 3D marker (imageLayer, videoLayer)\n     */\n    is3d(): boolean {\n        return false;\n    }\n\n    /**\n     * Checks if it is a normal marker (image, html, element)\n     */\n    isNormal(): boolean {\n        return false;\n    }\n\n    /**\n     * Checks if it is a polygon/polyline marker\n     */\n    isPoly(): boolean {\n        return false;\n    }\n\n    /**\n     * Checks if it is an SVG marker\n     */\n    isSvg(): boolean {\n        return false;\n    }\n\n    /**\n     * Updates the marker with new properties\n     * @throws {@link PSVError} if the configuration is invalid\n     * @internal\n     */\n    update(config: MarkerConfig) {\n        const newType = getMarkerType(config, true);\n\n        if (newType !== undefined && newType !== this.type) {\n            throw new PSVError('cannot change marker type');\n        }\n\n        if (utils.isExtendedPosition(config)) {\n            utils.logWarn('Use the \"position\" property to configure the position of a marker');\n            config.position = this.viewer.dataHelper.cleanPosition(config);\n        }\n\n        if ('width' in config && 'height' in config) {\n            utils.logWarn('Use the \"size\" property to configure the size of a marker');\n            // @ts-ignore\n            config.size = { width: config['width'], height: config['height'] };\n        }\n\n        this.config = utils.deepmerge(this.config, config as any);\n        if (typeof this.config.tooltip === 'string') {\n            this.config.tooltip = { content: this.config.tooltip };\n        }\n        if (this.config.tooltip && !this.config.tooltip.trigger) {\n            this.config.tooltip.trigger = 'hover';\n        }\n        if (utils.isNil(this.config.visible)) {\n            this.config.visible = true;\n        }\n        if (utils.isNil(this.config.zIndex)) {\n            this.config.zIndex = 1;\n        }\n        if (utils.isNil(this.config.opacity)) {\n            this.config.opacity = 1;\n        }\n\n        try {\n            this.config.rotation = utils.parseAngle(this.config.rotation ?? 0);\n        } catch (e) {\n            utils.logWarn((e as PSVError).message);\n            this.config.rotation = 0;\n        }\n\n        this.state.anchor = utils.parsePoint(this.config.anchor);\n    }\n\n    /**\n     * Returns the markers list content for the marker, it can be either :\n     * - the `listContent`\n     * - the `tooltip`\n     * - the `html`\n     * - the `id`\n     * @internal\n     */\n    getListContent(): string {\n        if (this.config.listContent) {\n            return this.config.listContent;\n        } else if (this.config.tooltip?.content) {\n            return this.config.tooltip.content;\n        } else if (this.config.html) {\n            return this.config.html;\n        } else {\n            return this.id;\n        }\n    }\n\n    /**\n     * Display the tooltip of this marker\n     * @internal\n     */\n    showTooltip(clientX?: number, clientY?: number) {\n        if (this.state.visible && this.config.tooltip?.content && this.state.position2D) {\n            const config: TooltipConfig = {\n                ...this.config.tooltip,\n                style: {\n                    // prevents conflicts with tooltip tracking\n                    pointerEvents: this.state.staticTooltip ? 'auto' : 'none',\n                },\n                data: this,\n                top: 0,\n                left: 0,\n            };\n\n            if (this.isPoly() || this.is3d()) {\n                if (clientX || clientY) {\n                    const viewerPos = utils.getPosition(this.viewer.container);\n                    config.top = clientY - viewerPos.y;\n                    config.left = clientX - viewerPos.x;\n                    config.box = {\n                        // separate the tooltip from the cursor\n                        width: 20,\n                        height: 20,\n                    };\n                } else {\n                    config.top = this.state.position2D.y;\n                    config.left = this.state.position2D.x;\n                }\n            } else {\n                // note: state.position2D already has the anchor applied with the default size\n                const position = this.viewer.dataHelper.vector3ToViewerCoords(this.state.positions3D[0]);\n                let width = this.state.size.width;\n                let height = this.state.size.height;\n\n                // only apply scaling for \"temporary\" tooltips\n                if (this.config.hoverScale && !this.state.staticTooltip) {\n                    width *= this.config.hoverScale.amount;\n                    height *= this.config.hoverScale.amount;\n                }\n\n                config.top = position.y - height * this.state.anchor.y + height / 2;\n                config.left = position.x - width * this.state.anchor.x + width / 2;\n                config.box = { width, height };\n            }\n\n            if (this.tooltip) {\n                this.tooltip.update(this.config.tooltip.content, config);\n            } else {\n                this.tooltip = this.viewer.createTooltip(config);\n            }\n        }\n    }\n\n    /**\n     * Hides the tooltip of this marker\n     * @internal\n     */\n    hideTooltip() {\n        if (this.tooltip) {\n            this.tooltip.hide();\n            this.tooltip = null;\n        }\n    }\n}\n","import { PSVError, utils, type Viewer } from '@photo-sphere-viewer/core';\nimport { type MarkersPlugin } from '../MarkersPlugin';\nimport { MarkerType } from '../MarkerType';\nimport { MarkerConfig } from '../model';\nimport { AbstractStandardMarker } from './AbstractStandardMarker';\n\n/**\n * @internal\n */\nexport class MarkerNormal extends AbstractStandardMarker {\n    constructor(viewer: Viewer, plugin: MarkersPlugin, config: MarkerConfig) {\n        super(viewer, plugin, config);\n    }\n\n    override isNormal(): boolean {\n        return true;\n    }\n\n    override createElement(): void {\n        this.element = document.createElement('div');\n        super.createElement();\n    }\n\n    override update(config: MarkerConfig): void {\n        super.update(config);\n\n        const element = this.domElement;\n\n        if (!utils.isExtendedPosition(this.config.position)) {\n            throw new PSVError('missing marker position');\n        }\n        if (this.config.image && !this.config.size) {\n            throw new PSVError('missing marker size');\n        }\n\n        if (this.config.size) {\n            this.state.dynamicSize = false;\n            this.state.size = this.config.size;\n            element.style.width = this.config.size.width + 'px';\n            element.style.height = this.config.size.height + 'px';\n        } else {\n            this.state.dynamicSize = true;\n        }\n\n        switch (this.type) {\n            case MarkerType.image:\n                this.definition = this.config.image;\n                element.style.backgroundImage = `url(\"${this.config.image}\")`;\n                break;\n            case MarkerType.html:\n                this.definition = this.config.html;\n                element.innerHTML = this.config.html;\n                break;\n            case MarkerType.element:\n                if (this.definition !== this.config.element) {\n                    this.definition = this.config.element;\n                    element.childNodes.forEach((n) => n.remove());\n                    element.appendChild(this.config.element);\n                    this.config.element.style.display = 'block';\n                }\n                break;\n        }\n\n        // set anchor\n        element.style.transformOrigin = `${this.state.anchor.x * 100}% ${this.state.anchor.y * 100}%`;\n\n        // convert texture coordinates to spherical coordinates\n        this.state.position = this.viewer.dataHelper.cleanPosition(this.config.position);\n\n        // compute x/y/z position\n        this.state.positions3D = [this.viewer.dataHelper.sphericalCoordsToVector3(this.state.position)];\n    }\n}\n","import { ExtendedPosition, PSVError, Point, Size, utils, type Viewer } from '@photo-sphere-viewer/core';\nimport {\n    Group,\n    Mesh,\n    Object3D,\n    PlaneGeometry,\n    Texture,\n    Vector3,\n    VideoTexture,\n} from 'three';\nimport { ChromaKeyMaterial } from '../../../shared/ChromaKeyMaterial';\nimport { createVideo } from '../../../shared/video-utils';\nimport { MarkerType } from '../MarkerType';\nimport { type MarkersPlugin } from '../MarkersPlugin';\nimport { MARKER_DATA } from '../constants';\nimport { MarkerConfig } from '../model';\nimport { getPolygonCenter } from '../utils';\nimport { Marker } from './Marker';\n\n/**\n * @internal\n */\nexport class Marker3D extends Marker {\n    override get threeElement(): Group {\n        return this.element;\n    }\n\n    get threeMesh(): Mesh<PlaneGeometry, ChromaKeyMaterial> {\n        return this.threeElement.children[0] as any;\n    }\n\n    override get video(): HTMLVideoElement {\n        if (this.type === MarkerType.videoLayer) {\n            return this.threeMesh.material.map.image;\n        } else {\n            return null;\n        }\n    }\n\n    constructor(viewer: Viewer, plugin: MarkersPlugin, config: MarkerConfig) {\n        super(viewer, plugin, config);\n    }\n\n    override is3d(): boolean {\n        return true;\n    }\n\n    override createElement(): void {\n        const material = new ChromaKeyMaterial({ alpha: 0 });\n        const geometry = new PlaneGeometry(1, 1);\n        const mesh = new Mesh(geometry, material);\n        mesh.userData = { [MARKER_DATA]: this };\n\n        // overwrite the visible property to be tied to the Marker instance\n        // and do it without context bleed\n        Object.defineProperty(mesh, 'visible', {\n            enumerable: true,\n            get: function (this: Object3D) {\n                return (this.userData[MARKER_DATA] as Marker).state.visible;\n            },\n            set: function (this: Object3D, visible: boolean) {\n                (this.userData[MARKER_DATA] as Marker).state.visible = visible;\n            },\n        });\n\n        this.element = new Group().add(mesh);\n\n        if (this.type === MarkerType.videoLayer) {\n            this.viewer.needsContinuousUpdate(true);\n        }\n    }\n\n    override destroy(): void {\n        delete this.threeMesh.userData[MARKER_DATA];\n\n        if (this.type === MarkerType.videoLayer) {\n            this.video.pause();\n            this.viewer.needsContinuousUpdate(false);\n        }\n\n        super.destroy();\n    }\n\n    override render(): Point {\n        if (this.viewer.renderer.isObjectVisible(this.threeMesh)) {\n            return this.viewer.dataHelper.sphericalCoordsToViewerCoords(this.state.position);\n        } else {\n            return null;\n        }\n    }\n\n    override update(config: MarkerConfig): void {\n        super.update(config);\n\n        const mesh = this.threeMesh;\n        const group = mesh.parent;\n        const material = mesh.material;\n\n        this.state.dynamicSize = false;\n\n        if (utils.isExtendedPosition(this.config.position)) {\n            if (!this.config.size) {\n                throw new PSVError('missing marker size');\n            }\n\n            this.state.position = this.viewer.dataHelper.cleanPosition(this.config.position);\n            this.state.size = this.config.size;\n\n            // 100 is magic number that gives a coherent size at default zoom level\n            mesh.scale.set(this.config.size.width / 100, this.config.size.height / 100, 1);\n            mesh.position.set(mesh.scale.x * (0.5 - this.state.anchor.x), mesh.scale.y * (this.state.anchor.y - 0.5), 0);\n            mesh.rotation.set(0, 0, -this.config.rotation);\n            this.viewer.dataHelper.sphericalCoordsToVector3(this.state.position, group.position);\n\n            group.lookAt(0, group.position.y, 0);\n            switch (this.config.orientation) {\n                case 'horizontal':\n                    group.rotateX(this.state.position.pitch < 0 ? -Math.PI / 2 : Math.PI / 2);\n                    break;\n                case 'vertical-left':\n                    group.rotateY(-Math.PI * 0.4);\n                    break;\n                case 'vertical-right':\n                    group.rotateY(Math.PI * 0.4);\n                    break;\n                // no default\n            }\n\n            const p = mesh.geometry.getAttribute('position');\n            this.state.positions3D = [0, 1, 3, 2].map((i) => {\n                const v3 = new Vector3();\n                v3.fromBufferAttribute(p, i);\n                return mesh.localToWorld(v3);\n            });\n        } else {\n            if (this.config.position?.length !== 4) {\n                throw new PSVError('missing marker position');\n            }\n\n            const positions = this.config.position.map((p) => this.viewer.dataHelper.cleanPosition(p));\n            const positions3D = positions.map((p) => this.viewer.dataHelper.sphericalCoordsToVector3(p));\n\n            const centroid = getPolygonCenter(positions.map(({ yaw, pitch }) => [yaw, pitch]));\n            this.state.position = { yaw: centroid[0], pitch: centroid[1] };\n\n            this.state.positions3D = positions3D;\n\n            const p = mesh.geometry.getAttribute('position');\n            [\n                positions3D[0],\n                positions3D[1],\n                positions3D[3], // not a mistake!\n                positions3D[2],\n            ].forEach((v, i) => {\n                p.setX(i, v.x);\n                p.setY(i, v.y);\n                p.setZ(i, v.z);\n            });\n            p.needsUpdate = true;\n\n            this.__setTextureWrap(material);\n        }\n\n        switch (this.type) {\n            case MarkerType.videoLayer:\n                if (this.definition !== this.config.videoLayer) {\n                    material.map?.dispose();\n\n                    const video = createVideo({\n                        src: this.config.videoLayer,\n                        withCredentials: this.viewer.config.withCredentials,\n                        muted: true,\n                        autoplay: this.config.autoplay ?? true,\n                    });\n\n                    const texture = new VideoTexture(video);\n                    material.map = texture;\n                    material.alpha = 0;\n\n                    video.addEventListener('loadedmetadata', () => {\n                        if (!this.viewer) {\n                            return; // the marker has been removed\n                        }\n\n                        material.alpha = this.config.opacity;\n\n                        if (!utils.isExtendedPosition(this.config.position)) {\n                            mesh.material.userData[MARKER_DATA] = { width: video.videoWidth, height: video.videoHeight };\n                            this.__setTextureWrap(material);\n                        }\n                    }, { once: true });\n\n                    this.definition = this.config.videoLayer;\n                } else {\n                    material.alpha = this.config.opacity;\n                }\n                break;\n\n            case MarkerType.imageLayer:\n                if (this.definition !== this.config.imageLayer) {\n                    material.map?.dispose();\n\n                    const texture = new Texture();\n                    material.map = texture;\n                    material.alpha = 0;\n\n                    this.viewer.textureLoader.loadImage(this.config.imageLayer).then((image) => {\n                        if (!this.viewer) {\n                            return; // the marker has been removed\n                        }\n\n                        if (!utils.isExtendedPosition(this.config.position)) {\n                            mesh.material.userData[MARKER_DATA] = { width: image.width, height: image.height };\n                            this.__setTextureWrap(material);\n                        }\n\n                        texture.image = image;\n                        texture.anisotropy = 4;\n                        texture.needsUpdate = true;\n                        material.alpha = this.config.opacity;\n\n                        this.viewer.needsUpdate();\n                    });\n\n                    this.definition = this.config.imageLayer;\n                } else {\n                    material.alpha = this.config.opacity;\n                }\n                break;\n\n            // no default\n        }\n\n        material.chromaKey = this.config.chromaKey;\n        mesh.renderOrder = 1000 + this.config.zIndex;\n        mesh.geometry.boundingBox = null; // reset box for Renderer.isObjectVisible\n    }\n\n    /**\n     * For layers positionned by corners, applies offset to the texture in order to keep its proportions\n     */\n    private __setTextureWrap(material: ChromaKeyMaterial) {\n        const imageSize: Size = material.userData[MARKER_DATA];\n\n        if (!imageSize || !imageSize.height || !imageSize.width) {\n            material.repeat.set(1, 1);\n            material.offset.set(0, 0);\n            return;\n        }\n\n        const positions = (this.config.position as ExtendedPosition[]).map((p) => {\n            return this.viewer.dataHelper.cleanPosition(p);\n        });\n\n        const w1 = utils.greatArcDistance(\n            [positions[0].yaw, positions[0].pitch],\n            [positions[1].yaw, positions[1].pitch]\n        );\n        const w2 = utils.greatArcDistance(\n            [positions[3].yaw, positions[3].pitch],\n            [positions[2].yaw, positions[2].pitch]\n        );\n        const h1 = utils.greatArcDistance(\n            [positions[1].yaw, positions[1].pitch],\n            [positions[2].yaw, positions[2].pitch]\n        );\n        const h2 = utils.greatArcDistance(\n            [positions[0].yaw, positions[0].pitch],\n            [positions[3].yaw, positions[3].pitch]\n        );\n\n        const layerRatio = (w1 + w2) / (h1 + h2);\n        const imageRatio = imageSize.width / imageSize.height;\n\n        let hMargin = 0;\n        let vMargin = 0;\n        if (layerRatio < imageRatio) {\n            hMargin = imageRatio - layerRatio;\n        } else {\n            vMargin = 1 / imageRatio - 1 / layerRatio;\n        }\n\n        material.repeat.set(1 - hMargin, 1 - vMargin);\n        material.offset.set(hMargin / 2, vMargin / 2);\n    }\n}\n","import { Color, ColorRepresentation, ShaderMaterial, Texture, Vector2 } from 'three';\nimport chromaKeyFragment from './shaders/chromaKey.fragment.glsl';\nimport chromaKeyVertex from './shaders/chromaKey.vertex.glsl';\n\ntype ShaderUniforms = {\n    map: { value: Texture };\n    repeat: { value: Vector2 };\n    offset: { value: Vector2 };\n    alpha: { value: number };\n    keying: { value: boolean };\n    color: { value: Color };\n    similarity: { value: number };\n    smoothness: { value: number };\n    spill: { value: number };\n};\n\ntype ChromaKey = {\n    /** @default false */\n    enabled: boolean;\n    /** @default 0x00ff00 */\n    color?: ColorRepresentation | { r: number; g: number; b: number };\n    /** @default 0.2 */\n    similarity?: number;\n    /** @default 0.2 */\n    smoothness?: number;\n};\n\nexport class ChromaKeyMaterial extends ShaderMaterial {\n    override uniforms: ShaderUniforms;\n\n    get map(): Texture {\n        return this.uniforms.map.value;\n    }\n\n    set map(map: Texture) {\n        this.uniforms.map.value = map;\n    }\n\n    set alpha(alpha: number) {\n        this.uniforms.alpha.value = alpha;\n    }\n\n    get offset(): Vector2 {\n        return this.uniforms.offset.value;\n    }\n\n    get repeat(): Vector2 {\n        return this.uniforms.repeat.value;\n    }\n\n    set chromaKey(chromaKey: ChromaKey) {\n        this.uniforms.keying.value = chromaKey?.enabled === true;\n        if (chromaKey?.enabled) {\n            if (typeof chromaKey.color === 'object' && 'r' in chromaKey.color) {\n                this.uniforms.color.value.set(\n                    chromaKey.color.r / 255,\n                    chromaKey.color.g / 255,\n                    chromaKey.color.b / 255\n                );\n            } else {\n                this.uniforms.color.value.set(chromaKey.color ?? 0x00ff00);\n            }\n            this.uniforms.similarity.value = chromaKey.similarity ?? 0.2;\n            this.uniforms.smoothness.value = chromaKey.smoothness ?? 0.2;\n        }\n    }\n\n    constructor(params?: {\n        map?: Texture;\n        alpha?: number;\n        chromaKey?: ChromaKey;\n    }) {\n        super({\n            transparent: true,\n            depthTest: false,\n            uniforms: {\n                map: { value: params?.map },\n                repeat: { value: new Vector2(1, 1) },\n                offset: { value: new Vector2(0, 0) },\n                alpha: { value: params?.alpha ?? 1 },\n                keying: { value: false },\n                color: { value: new Color(0x00ff00) },\n                similarity: { value: 0.2 },\n                smoothness: { value: 0.2 },\n                spill: { value: 0.1 },\n            } as ShaderUniforms,\n            vertexShader: chromaKeyVertex,\n            fragmentShader: chromaKeyFragment,\n        });\n\n        this.chromaKey = params?.chromaKey;\n    }\n}\n","// https://www.8thwall.com/playground/chromakey-threejs\n\nuniform sampler2D map;\nuniform float alpha;\nuniform bool keying;\nuniform vec3 color;\nuniform float similarity;\nuniform float smoothness;\nuniform float spill;\n\nvarying vec2 vUv;\n\nvec2 RGBtoUV(vec3 rgb) {\n    return vec2(\n        rgb.r * -0.169 + rgb.g * -0.331 + rgb.b *  0.5    + 0.5,\n        rgb.r *  0.5   + rgb.g * -0.419 + rgb.b * -0.081  + 0.5\n    );\n}\n\nvoid main(void) {\n    gl_FragColor = texture2D(map, vUv);\n\n    if (keying) {\n        float chromaDist = distance(RGBtoUV(gl_FragColor.rgb), RGBtoUV(color));\n\n        float baseMask = chromaDist - similarity;\n        float fullMask = pow(clamp(baseMask / smoothness, 0., 1.), 1.5);\n        gl_FragColor.a *= fullMask * alpha;\n\n        float spillVal = pow(clamp(baseMask / spill, 0., 1.), 1.5);\n        float desat = clamp(gl_FragColor.r * 0.2126 + gl_FragColor.g * 0.7152 + gl_FragColor.b * 0.0722, 0., 1.);\n        gl_FragColor.rgb = mix(vec3(desat, desat, desat), gl_FragColor.rgb, spillVal);\n    } else {\n        gl_FragColor.a *= alpha;\n    }\n}\n","varying vec2 vUv;\nuniform vec2 repeat;\nuniform vec2 offset;\n\nvoid main() {\n    vUv = uv * repeat + offset;\n    gl_Position = projectionMatrix *  modelViewMatrix * vec4( position, 1.0 );\n}\n","/**\n * Create a standard video element\n */\nexport function createVideo({\n    src,\n    withCredentials,\n    muted,\n    autoplay,\n}: {\n    src: string;\n    withCredentials: boolean;\n    muted: boolean;\n    autoplay: boolean;\n}): HTMLVideoElement {\n    const video = document.createElement('video');\n    video.crossOrigin = withCredentials ? 'use-credentials' : 'anonymous';\n    video.loop = true;\n    video.playsInline = true;\n    video.autoplay = autoplay;\n    video.muted = muted;\n    video.preload = 'metadata';\n    video.src = src;\n    return video;\n}\n","import { CONSTANTS, utils } from '@photo-sphere-viewer/core';\nimport { Vector3 } from 'three';\n\n/**\n * Returns intermediary point between two points on the sphere\n * {@link http://www.movable-type.co.uk/scripts/latlong.html}\n */\nfunction greatArcIntermediaryPoint(p1: [number, number], p2: [number, number], f: number): [number, number] {\n    const [1, 1] = p1;\n    const [2, 2] = p2;\n\n    const r = utils.greatArcDistance(p1, p2);\n    const a = Math.sin((1 - f) * r) / Math.sin(r);\n    const b = Math.sin(f * r) / Math.sin(r);\n    const x = a * Math.cos(1) * Math.cos(1) + b * Math.cos(2) * Math.cos(2);\n    const y = a * Math.cos(1) * Math.sin(1) + b * Math.cos(2) * Math.sin(2);\n    const z = a * Math.sin(1) + b * Math.sin(2);\n\n    return [Math.atan2(y, x), Math.atan2(z, Math.sqrt(x * x + y * y))];\n}\n\n/**\n * Given a list of spherical points, offsets yaws in order to have only coutinuous values\n * eg: [0.2, 6.08] is transformed to [0.2, -0.2]\n */\nfunction getPolygonCoherentPoints(points: Array<[number, number]>) {\n    const workPoints = [points[0]];\n\n    let k = 0;\n    for (let i = 1; i < points.length; i++) {\n        const d = points[i - 1][0] - points[i][0];\n        if (d > Math.PI) {\n            // crossed the origin left to right\n            k += 1;\n        } else if (d < -Math.PI) {\n            // crossed the origin right to left\n            k -= 1;\n        }\n        workPoints.push([points[i][0] + k * 2 * Math.PI, points[i][1]]);\n    }\n\n    return workPoints;\n}\n\n/**\n * Computes the center point of a polygon\n * @todo Get \"visual center\" (https://blog.mapbox.com/a-new-algorithm-for-finding-a-visual-center-of-a-polygon-7c77e6492fbc)\n * @internal\n */\nexport function getPolygonCenter(polygon: Array<[number, number]>): [number, number] {\n    const points = getPolygonCoherentPoints(polygon);\n\n    const sum = points.reduce((intermediary, point) => [intermediary[0] + point[0], intermediary[1] + point[1]]);\n    return [utils.parseAngle(sum[0] / polygon.length), sum[1] / polygon.length];\n}\n\n/**\n * Computes the middle point of a polyline\n * @internal\n */\nexport function getPolylineCenter(polyline: Array<[number, number]>): [number, number] {\n    const points = getPolygonCoherentPoints(polyline);\n\n    // compute each segment length + total length\n    let length = 0;\n    const lengths = [];\n\n    for (let i = 0; i < points.length - 1; i++) {\n        const l = utils.greatArcDistance(points[i], points[i + 1]) * CONSTANTS.SPHERE_RADIUS;\n\n        lengths.push(l);\n        length += l;\n    }\n\n    // iterate until length / 2\n    let consumed = 0;\n\n    for (let j = 0; j < points.length - 1; j++) {\n        // once the segment containing the middle point is found, computes the intermediary point\n        if (consumed + lengths[j] > length / 2) {\n            const r = (length / 2 - consumed) / lengths[j];\n            return greatArcIntermediaryPoint(points[j], points[j + 1], r);\n        }\n\n        consumed += lengths[j];\n    }\n\n    // this never happens\n    return points[Math.round(points.length / 2)];\n}\n\nconst C = new Vector3();\nconst N = new Vector3();\nconst V = new Vector3();\nconst X = new Vector3();\nconst Y = new Vector3();\nconst A = new Vector3();\n\n/**\n * Given one point in the same direction of the camera and one point behind the camera,\n * computes an intermediary point on the great circle delimiting the half sphere visible by the camera.\n * The point is shifted by .01 rad because the projector cannot handle points exactly on this circle.\n * @todo : does not work with fisheye view (must not use the great circle)\n * @link http://math.stackexchange.com/a/1730410/327208\n */\nexport function getGreatCircleIntersection(P1: Vector3, P2: Vector3, direction: Vector3): Vector3 {\n    C.copy(direction).normalize();\n    N.crossVectors(P1, P2).normalize();\n    V.crossVectors(N, P1).normalize();\n    X.copy(P1).multiplyScalar(-C.dot(V));\n    Y.copy(V).multiplyScalar(C.dot(P1));\n    const H = new Vector3().addVectors(X, Y).normalize();\n    A.crossVectors(H, C);\n    return H.applyAxisAngle(A, 0.01).multiplyScalar(CONSTANTS.SPHERE_RADIUS);\n}\n","import { Point, Viewer, utils } from '@photo-sphere-viewer/core';\nimport { Vector3 } from 'three';\nimport { MarkerType } from '../MarkerType';\nimport { MarkersPlugin } from '../MarkersPlugin';\nimport { MARKER_DATA, SVG_NS } from '../constants';\nimport { MarkerConfig } from '../model';\nimport { getGreatCircleIntersection, getPolygonCenter, getPolylineCenter } from '../utils';\nimport { AbstractDomMarker } from './AbstractDomMarker';\n\n/**\n * @internal\n */\nexport class MarkerPolygon extends AbstractDomMarker {\n    constructor(viewer: Viewer, plugin: MarkersPlugin, config: MarkerConfig) {\n        super(viewer, plugin, config);\n    }\n\n    override createElement(): void {\n        this.element = document.createElementNS(SVG_NS, this.isPolygon ? 'polygon' : 'polyline');\n        this.element[MARKER_DATA] = this;\n    }\n\n    override isPoly(): boolean {\n        return true;\n    }\n\n    /**\n     * Checks if it is a polygon/polyline using pixel coordinates\n     */\n    private get isPixels(): boolean {\n        return this.type === MarkerType.polygonPixels || this.type === MarkerType.polylinePixels;\n    }\n\n    /**\n     * Checks if it is a polygon marker\n     */\n    private get isPolygon(): boolean {\n        return this.type === MarkerType.polygon || this.type === MarkerType.polygonPixels;\n    }\n\n    /**\n     * Checks if it is a polyline marker\n     */\n    private get isPolyline(): boolean {\n        return this.type === MarkerType.polyline || this.type === MarkerType.polylinePixels;\n    }\n\n    override render(): Point {\n        const positions = this.__getPolyPositions();\n        const isVisible = positions.length > (this.isPolygon ? 2 : 1);\n\n        if (isVisible) {\n            const position = this.viewer.dataHelper.sphericalCoordsToViewerCoords(this.state.position);\n\n            const points = positions.map((pos) => pos.x - position.x + ',' + (pos.y - position.y)).join(' ');\n\n            this.domElement.setAttributeNS(null, 'points', points);\n            this.domElement.setAttributeNS(null, 'transform', `translate(${position.x} ${position.y})`);\n\n            return position;\n        } else {\n            return null;\n        }\n    }\n\n    override update(config: MarkerConfig): void {\n        super.update(config);\n\n        const element = this.domElement;\n\n        element.classList.add('psv-marker--poly');\n\n        this.state.dynamicSize = true;\n\n        // set style\n        if (this.config.svgStyle) {\n            Object.entries(this.config.svgStyle).forEach(([prop, value]) => {\n                element.setAttributeNS(null, utils.dasherize(prop), value);\n            });\n\n            if (this.isPolyline && !this.config.svgStyle.fill) {\n                element.setAttributeNS(null, 'fill', 'none');\n            }\n        } else if (this.isPolygon) {\n            element.setAttributeNS(null, 'fill', 'rgba(0,0,0,0.5)');\n        } else if (this.isPolyline) {\n            element.setAttributeNS(null, 'fill', 'none');\n            element.setAttributeNS(null, 'stroke', 'rgb(0,0,0)');\n        }\n\n        // fold arrays: [1,2,3,4] => [[1,2],[3,4]]\n        const actualPoly: any = this.config[this.type];\n        if (!Array.isArray(actualPoly[0])) {\n            for (let i = 0; i < actualPoly.length; i++) {\n                // @ts-ignore\n                actualPoly.splice(i, 2, [actualPoly[i], actualPoly[i + 1]]);\n            }\n        }\n\n        // convert texture coordinates to spherical coordinates\n        if (this.isPixels) {\n            this.definition = (actualPoly as Array<[number, number]>).map((coord) => {\n                const sphericalCoords = this.viewer.dataHelper.textureCoordsToSphericalCoords({\n                    textureX: coord[0],\n                    textureY: coord[1],\n                });\n                return [sphericalCoords.yaw, sphericalCoords.pitch];\n            });\n        }\n        // clean angles\n        else {\n            this.definition = (actualPoly as Array<[number | string, number | string]>).map((coord) => {\n                return [utils.parseAngle(coord[0]), utils.parseAngle(coord[1], true)];\n            });\n        }\n\n        const centroid = this.isPolygon ? getPolygonCenter(this.definition) : getPolylineCenter(this.definition);\n        this.state.position = { yaw: centroid[0], pitch: centroid[1] };\n\n        // compute x/y/z positions\n        this.state.positions3D = (this.definition as Array<[number, number]>).map((coord) => {\n            return this.viewer.dataHelper.sphericalCoordsToVector3({ yaw: coord[0], pitch: coord[1] });\n        });\n    }\n\n    /**\n     * Computes viewer coordinates of each point of a polygon/polyline<br>\n     * It handles points behind the camera by creating intermediary points suitable for the projector\n     */\n    private __getPolyPositions(): Point[] {\n        const nbVectors = this.state.positions3D.length;\n\n        // compute if each vector is visible\n        const positions3D = this.state.positions3D.map((vector) => {\n            return {\n                vector: vector,\n                visible: vector.dot(this.viewer.state.direction) > 0,\n            };\n        });\n\n        // get pairs of visible/invisible vectors for each invisible vector connected to a visible vector\n        const toBeComputed: Array<{ visible: Vector3; invisible: Vector3; index: number }> = [];\n        positions3D.forEach((pos, i) => {\n            if (!pos.visible) {\n                const neighbours = [\n                    i === 0 ? positions3D[nbVectors - 1] : positions3D[i - 1],\n                    i === nbVectors - 1 ? positions3D[0] : positions3D[i + 1],\n                ];\n\n                neighbours.forEach((neighbour) => {\n                    if (neighbour.visible) {\n                        toBeComputed.push({\n                            visible: neighbour.vector,\n                            invisible: pos.vector,\n                            index: i,\n                        });\n                    }\n                });\n            }\n        });\n\n        // compute intermediary vector for each pair (the loop is reversed for splice to insert at the right place)\n        toBeComputed.reverse().forEach((pair) => {\n            positions3D.splice(pair.index, 0, {\n                vector: getGreatCircleIntersection(pair.visible, pair.invisible, this.viewer.state.direction),\n                visible: true,\n            });\n        });\n\n        // translate vectors to screen pos\n        return positions3D\n            .filter((pos) => pos.visible)\n            .map((pos) => this.viewer.dataHelper.vector3ToViewerCoords(pos.vector));\n    }\n}\n","import { PSVError, utils, type Viewer } from '@photo-sphere-viewer/core';\nimport { SVG_NS } from '../constants';\nimport { type MarkersPlugin } from '../MarkersPlugin';\nimport { MarkerType } from '../MarkerType';\nimport { MarkerConfig } from '../model';\nimport { AbstractStandardMarker } from './AbstractStandardMarker';\n\n/**\n * @internal\n */\nexport class MarkerSvg extends AbstractStandardMarker {\n    constructor(viewer: Viewer, plugin: MarkersPlugin, config: MarkerConfig) {\n        super(viewer, plugin, config);\n    }\n\n    override isSvg(): boolean {\n        return true;\n    }\n\n    override createElement(): void {\n        const svgType = this.type === MarkerType.square ? 'rect' : this.type;\n        const elt = document.createElementNS(SVG_NS, svgType);\n        this.element = document.createElementNS(SVG_NS, 'svg');\n        this.element.appendChild(elt);\n\n        super.createElement();\n    }\n\n    override update(config: MarkerConfig): void {\n        super.update(config);\n\n        const svgElement = this.domElement.firstElementChild as SVGElement;\n\n        if (!utils.isExtendedPosition(this.config.position)) {\n            throw new PSVError('missing marker position');\n        }\n\n        this.state.dynamicSize = true;\n\n        // set content\n        switch (this.type) {\n            case MarkerType.square:\n                this.definition = {\n                    x: 0,\n                    y: 0,\n                    width: this.config.square,\n                    height: this.config.square,\n                };\n                break;\n\n            case MarkerType.rect:\n                if (Array.isArray(this.config.rect)) {\n                    this.definition = {\n                        x: 0,\n                        y: 0,\n                        width: this.config.rect[0],\n                        height: this.config.rect[1],\n                    };\n                } else {\n                    this.definition = {\n                        x: 0,\n                        y: 0,\n                        width: this.config.rect.width,\n                        height: this.config.rect.height,\n                    };\n                }\n                break;\n\n            case MarkerType.circle:\n                this.definition = {\n                    cx: this.config.circle,\n                    cy: this.config.circle,\n                    r: this.config.circle,\n                };\n                break;\n\n            case MarkerType.ellipse:\n                if (Array.isArray(this.config.ellipse)) {\n                    this.definition = {\n                        cx: this.config.ellipse[0],\n                        cy: this.config.ellipse[1],\n                        rx: this.config.ellipse[0],\n                        ry: this.config.ellipse[1],\n                    };\n                } else {\n                    this.definition = {\n                        cx: this.config.ellipse.rx,\n                        cy: this.config.ellipse.ry,\n                        rx: this.config.ellipse.rx,\n                        ry: this.config.ellipse.ry,\n                    };\n                }\n                break;\n\n            case MarkerType.path:\n                this.definition = {\n                    d: this.config.path,\n                };\n                break;\n\n            // no default\n        }\n\n        Object.entries(this.definition).forEach(([prop, value]) => {\n            svgElement.setAttributeNS(null, prop, value as string);\n        });\n\n        // set style\n        if (this.config.svgStyle) {\n            Object.entries(this.config.svgStyle).forEach(([prop, value]) => {\n                svgElement.setAttributeNS(null, utils.dasherize(prop), value);\n            });\n        } else {\n            svgElement.setAttributeNS(null, 'fill', 'rgba(0,0,0,0.5)');\n        }\n\n        // set anchor\n        this.domElement.style.transformOrigin = `${this.state.anchor.x * 100}% ${this.state.anchor.y * 100}%`;\n\n        // convert texture coordinates to spherical coordinates\n        this.state.position = this.viewer.dataHelper.cleanPosition(this.config.position);\n\n        // compute x/y/z position\n        this.state.positions3D = [this.viewer.dataHelper.sphericalCoordsToVector3(this.state.position)];\n    }\n}\n"],"mappings":"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","names":["import_core","import_core","import_core","import_core","import_core","import_core","import_core","MarkerType","import_core","import_core","import_core","import_core","import_three","import_three","import_core","import_three","p","import_core","import_core"]}