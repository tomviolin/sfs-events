{"version":3,"sources":["src/index.ts","src/events.ts","src/VirtualTourPlugin.ts","src/ArrowsRenderer.ts","src/constants.ts","src/arrow.svg","src/models/arrow.json","src/models/arrow_outline.json","src/utils.ts","src/datasources/ClientSideDatasource.ts","src/datasources/AbstractDataSource.ts","src/datasources/ServerSideDatasource.ts"],"sourcesContent":["import * as events from './events';\n\nexport * from './model';\nexport { VirtualTourPlugin } from './VirtualTourPlugin';\nexport { events };\n\n/** @internal  */\nimport './style.scss';\n","import { Position, TypedEvent } from '@photo-sphere-viewer/core';\nimport { VirtualTourLink, VirtualTourNode } from './model';\nimport type { VirtualTourPlugin } from './VirtualTourPlugin';\n\n/**\n * @event Triggered when the current node changes\n */\nexport class NodeChangedEvent extends TypedEvent<VirtualTourPlugin> {\n    static override readonly type = 'node-changed';\n    override type: 'node-changed';\n\n    /** @internal */\n    constructor(\n        public readonly node: VirtualTourNode,\n        public readonly data: {\n            fromNode: VirtualTourNode;\n            fromLink: VirtualTourLink;\n            fromLinkPosition: Position;\n        }\n    ) {\n        super(NodeChangedEvent.type);\n    }\n}\n\n/**\n * @event Triggered when the user puts the cursor hover a marker\n */\nexport class EnterArrowEvent extends TypedEvent<VirtualTourPlugin> {\n    static override readonly type = 'enter-arrow';\n    override type: 'enter-arrow';\n\n    /** @internal */\n    constructor(\n        public readonly link: VirtualTourLink,\n        public readonly node: VirtualTourNode\n    ) {\n        super(EnterArrowEvent.type);\n    }\n}\n\n/**\n * @event Triggered when the user puts the cursor away from an arrow\n */\nexport class LeaveArrowEvent extends TypedEvent<VirtualTourPlugin> {\n    static override readonly type = 'leave-arrow';\n    override type: 'leave-arrow';\n\n    /** @internal */\n    constructor(\n        public readonly link: VirtualTourLink,\n        public readonly node: VirtualTourNode\n    ) {\n        super(LeaveArrowEvent.type);\n    }\n}\n\nexport type VirtualTourEvents = \n    | NodeChangedEvent\n    | EnterArrowEvent\n    | LeaveArrowEvent;\n","import type { CompassPlugin } from '@photo-sphere-viewer/compass-plugin';\nimport type { Point, Position, Tooltip, Viewer } from '@photo-sphere-viewer/core';\nimport { AbstractConfigurablePlugin, PSVError, events, utils } from '@photo-sphere-viewer/core';\nimport type { GalleryPlugin } from '@photo-sphere-viewer/gallery-plugin';\nimport type { MapPlugin, events as mapEvents } from '@photo-sphere-viewer/map-plugin';\nimport type { PlanPlugin, events as planEvents } from '@photo-sphere-viewer/plan-plugin';\nimport type { Marker, MarkerConfig, MarkersPlugin, events as markersEvents } from '@photo-sphere-viewer/markers-plugin';\nimport { MathUtils, Mesh } from 'three';\nimport { ArrowsRenderer } from './ArrowsRenderer';\nimport { DEFAULT_ARROW, DEFAULT_MARKER, LINK_DATA, LINK_ID, LOADING_TOOLTIP } from './constants';\nimport { AbstractDatasource } from './datasources/AbstractDataSource';\nimport { ClientSideDatasource } from './datasources/ClientSideDatasource';\nimport { ServerSideDatasource } from './datasources/ServerSideDatasource';\nimport { EnterArrowEvent, LeaveArrowEvent, NodeChangedEvent, VirtualTourEvents } from './events';\nimport {\n    GpsPosition,\n    VirtualTourLink,\n    VirtualTourMarkerStyle,\n    VirtualTourNode,\n    VirtualTourPluginConfig,\n    VirtualTourTransitionOptions,\n} from './model';\nimport { gpsDistance, gpsToSpherical, setMeshColor } from './utils';\n\nconst getConfig = utils.getConfigParser<VirtualTourPluginConfig>(\n    {\n        dataMode: 'client',\n        positionMode: 'manual',\n        renderMode: '3d',\n        nodes: null,\n        getNode: null,\n        startNodeId: null,\n        preload: false,\n        transitionOptions: {\n            showLoader: true,\n            speed: '20rpm',\n            fadeIn: true,\n            rotation: true,\n        },\n        linksOnCompass: true,\n        getLinkTooltip: null,\n        markerStyle: DEFAULT_MARKER,\n        arrowStyle: DEFAULT_ARROW,\n        markerPitchOffset: -0.1,\n        arrowPosition: 'bottom',\n        map: null,\n    },\n    {\n        dataMode(dataMode) {\n            if (dataMode !== 'client' && dataMode !== 'server') {\n                throw new PSVError('VirtualTourPlugin: invalid dataMode');\n            }\n            return dataMode;\n        },\n        positionMode(positionMode) {\n            if (positionMode !== 'gps' && positionMode !== 'manual') {\n                throw new PSVError('VirtualTourPlugin: invalid positionMode');\n            }\n            return positionMode;\n        },\n        renderMode(renderMode) {\n            if (renderMode !== '3d' && renderMode !== 'markers') {\n                throw new PSVError('VirtualTourPlugin: invalid renderMode');\n            }\n            return renderMode;\n        },\n        markerStyle(markerStyle, { defValue }) {\n            // historically the user set \"html=null\" to override the marker type\n            if (markerStyle.html === null) {\n                markerStyle.element = null;\n            }\n            return { ...defValue, ...markerStyle };\n        },\n        arrowStyle(arrowStyle, { defValue }) {\n            return { ...defValue, ...arrowStyle };\n        },\n        map(map, { rawConfig }) {\n            if (map) {\n                if (rawConfig.dataMode === 'server') {\n                    utils.logWarn('VirtualTourPlugin: The map cannot be used in server side mode');\n                    return null;\n                }\n                if (!map.imageUrl) {\n                    utils.logWarn('VirtualTourPlugin: configuring the map requires at least \"imageUrl\"');\n                    return null;\n                }\n            }\n            return map;\n        },\n    }\n);\n\n/**\n * Creates virtual tours by linking multiple panoramas\n */\nexport class VirtualTourPlugin extends AbstractConfigurablePlugin<\n    VirtualTourPluginConfig,\n    VirtualTourPluginConfig,\n    never,\n    VirtualTourEvents\n> {\n    static override readonly id = 'virtual-tour';\n    static override readonly VERSION = PKG_VERSION;\n    static override readonly configParser = getConfig;\n    static override readonly readonlyOptions = Object.keys(getConfig.defaults);\n\n    private readonly state = {\n        currentNode: null as VirtualTourNode,\n        currentTooltip: null as Tooltip,\n        loadingNode: null as string,\n        preload: {} as Record<string, boolean | Promise<any>>,\n    };\n\n    private datasource: AbstractDatasource;\n    private arrowsRenderer: ArrowsRenderer;\n\n    private map?: MapPlugin;\n    private plan?: PlanPlugin;\n    private markers?: MarkersPlugin;\n    private compass?: CompassPlugin;\n    private gallery?: GalleryPlugin;\n\n    get is3D(): boolean {\n        return this.config.renderMode === '3d';\n    }\n\n    get isServerSide(): boolean {\n        return this.config.dataMode === 'server';\n    }\n\n    get isGps(): boolean {\n        return this.config.positionMode === 'gps';\n    }\n\n    constructor(viewer: Viewer, config: VirtualTourPluginConfig) {\n        super(viewer, config);\n\n        if (this.is3D) {\n            this.arrowsRenderer = new ArrowsRenderer(this.viewer, this);\n        }\n    }\n\n    /**\n     * @internal\n     */\n    override init() {\n        super.init();\n\n        utils.checkStylesheet(this.viewer.container, 'virtual-tour-plugin');\n\n        this.markers = this.viewer.getPlugin('markers');\n        this.compass = this.viewer.getPlugin('compass');\n        this.gallery = this.viewer.getPlugin('gallery');\n\n        if (!this.is3D && !this.markers) {\n            throw new PSVError('VirtualTour plugin requires the Markers plugin in markers mode.');\n        }\n\n        if (this.markers?.config.markers) {\n            utils.logWarn(\n                'No default markers can be configured on Markers plugin when using VirtualTour plugin. '\n                + 'Consider defining `markers` on each tour node.'\n            );\n            delete this.markers.config.markers;\n        }\n\n        if (this.config.map) {\n            this.map = this.viewer.getPlugin('map');\n            if (!this.map) {\n                utils.logWarn('The map is configured on the VirtualTourPlugin but the MapPlugin is not loaded.');\n            }\n        }\n\n        if (this.isGps) {\n            this.plan = this.viewer.getPlugin('plan');\n        }\n\n        this.datasource = this.isServerSide\n            ? new ServerSideDatasource(this, this.viewer)\n            : new ClientSideDatasource(this, this.viewer);\n\n        if (this.is3D) {\n            this.viewer.observeObjects(LINK_DATA);\n\n            this.viewer.addEventListener(events.PositionUpdatedEvent.type, this);\n            this.viewer.addEventListener(events.SizeUpdatedEvent.type, this);\n            this.viewer.addEventListener(events.ClickEvent.type, this);\n            this.viewer.addEventListener(events.ObjectEnterEvent.type, this);\n            this.viewer.addEventListener(events.ObjectHoverEvent.type, this);\n            this.viewer.addEventListener(events.ObjectLeaveEvent.type, this);\n            this.viewer.addEventListener(events.ReadyEvent.type, this, { once: true });\n\n            this.viewer.renderer.setCustomRenderer((renderer) => this.arrowsRenderer.withRenderer(renderer));\n        } else {\n            this.markers.addEventListener('select-marker', this);\n            this.viewer.addEventListener(events.ShowTooltipEvent.type, this);\n        }\n\n        if (this.map) {\n            this.map.addEventListener('select-hotspot', this);\n            this.map.setImage(this.config.map.imageUrl);\n        }\n\n        this.plan?.addEventListener('select-hotspot', this);\n\n        if (this.isServerSide) {\n            if (this.config.startNodeId) {\n                this.setCurrentNode(this.config.startNodeId);\n            }\n        } else if (this.config.nodes) {\n            this.setNodes(this.config.nodes, this.config.startNodeId);\n            delete this.config.nodes;\n        }\n    }\n\n    /**\n     * @internal\n     */\n    override destroy() {\n        if (this.is3D) {\n            this.viewer.renderer.setCustomRenderer(null);\n        }\n\n        this.markers?.removeEventListener('select-marker', this);\n        this.map?.removeEventListener('select-hotspot', this);\n        this.plan?.removeEventListener('select-hotspot', this);\n\n        this.viewer.removeEventListener(events.PositionUpdatedEvent.type, this);\n        this.viewer.removeEventListener(events.SizeUpdatedEvent.type, this);\n        this.viewer.removeEventListener(events.ClickEvent.type, this);\n        this.viewer.removeEventListener(events.ObjectEnterEvent.type, this);\n        this.viewer.removeEventListener(events.ObjectHoverEvent.type, this);\n        this.viewer.removeEventListener(events.ObjectLeaveEvent.type, this);\n        this.viewer.removeEventListener(events.ShowTooltipEvent.type, this);\n        this.viewer.removeEventListener(events.ReadyEvent.type, this);\n\n        this.viewer.unobserveObjects(LINK_DATA);\n\n        this.datasource.destroy();\n        this.arrowsRenderer?.destroy();\n\n        delete this.datasource;\n        delete this.markers;\n        delete this.compass;\n        delete this.gallery;\n        delete this.arrowsRenderer;\n\n        super.destroy();\n    }\n\n    /**\n     * @internal\n     */\n    handleEvent(e: Event) {\n        if (\n            e instanceof events.SizeUpdatedEvent\n            || e instanceof events.PositionUpdatedEvent\n            || e instanceof events.ReadyEvent\n        ) {\n            this.arrowsRenderer.updateCamera();\n        } else if (e instanceof events.ClickEvent) {\n            const link = e.data.objects.find((o) => o.userData[LINK_DATA])?.userData[LINK_DATA];\n            if (link) {\n                this.setCurrentNode(link.nodeId, null, link);\n            }\n        } else if (e.type === 'select-marker') {\n            const marker = (e as markersEvents.SelectMarkerEvent).marker;\n            const link = marker.data?.[LINK_DATA];\n            if (link) {\n                this.setCurrentNode(link.nodeId, null, link);\n            }\n        } else if (e instanceof events.ShowTooltipEvent) {\n            const marker = (e as events.ShowTooltipEvent).tooltipData as Marker;\n            if (marker?.id.startsWith(LINK_ID)) {\n                this.__onEnterMarker(marker, marker.data[LINK_DATA]);\n            }\n        } else if (e instanceof events.ObjectEnterEvent) {\n            if (e.userDataKey === LINK_DATA) {\n                this.__onEnterObject(e.object, e.viewerPoint);\n            }\n        } else if (e instanceof events.ObjectLeaveEvent) {\n            if (e.userDataKey === LINK_DATA) {\n                this.__onLeaveObject(e.object);\n            }\n        } else if (e instanceof events.ObjectHoverEvent) {\n            if (e.userDataKey === LINK_DATA) {\n                this.__onHoverObject(e.viewerPoint);\n            }\n        } else if (e.type === 'select-hotspot') {\n            const id = (e as mapEvents.SelectHotspot | planEvents.SelectHotspot).hotspotId;\n            if (id.startsWith(LINK_ID)) {\n                this.setCurrentNode(id.substring(LINK_ID.length));\n            }\n        }\n    }\n\n    /**\n     * Returns the current node\n     */\n    getCurrentNode(): VirtualTourNode {\n        return this.state.currentNode;\n    }\n\n    /**\n     * Sets the nodes (client mode only)\n     * @throws {@link PSVError} if not in client mode\n     */\n    setNodes(nodes: VirtualTourNode[], startNodeId?: string) {\n        if (this.isServerSide) {\n            throw new PSVError('Cannot set nodes in server side mode');\n        }\n\n        this.state.currentTooltip?.hide();\n        this.state.currentTooltip = null;\n        this.state.currentNode = null;\n\n        (this.datasource as ClientSideDatasource).setNodes(nodes);\n\n        if (!startNodeId) {\n            startNodeId = nodes[0].id;\n        } else if (!this.datasource.nodes[startNodeId]) {\n            startNodeId = nodes[0].id;\n            utils.logWarn(`startNodeId not found is provided nodes, resetted to ${startNodeId}`);\n        }\n        this.setCurrentNode(startNodeId);\n\n        if (this.gallery) {\n            this.gallery.setItems(\n                nodes.map((node) => ({\n                    id: node.id,\n                    panorama: node.panorama,\n                    name: node.name,\n                    thumbnail: node.thumbnail,\n                    options: {\n                        caption: node.caption,\n                        panoData: node.panoData,\n                        sphereCorrection: node.sphereCorrection,\n                        description: node.description,\n                    },\n                })),\n                (id) => {\n                    this.setCurrentNode(id as string);\n                }\n            );\n        }\n\n        if (this.map) {\n            this.map.setHotspots([\n                ...nodes.map((node) => ({\n                    ...(node.map || {}),\n                    ...this.__getNodeMapPosition(node),\n                    id: LINK_ID + node.id,\n                    tooltip: node.name,\n                })),\n            ]);\n        }\n\n        if (this.plan) {\n            this.plan.setHotspots([\n                ...nodes.map((node) => ({\n                    ...(node.plan || {}),\n                    coordinates: node.gps,\n                    id: LINK_ID + node.id,\n                    tooltip: node.name,\n                })),\n            ]);\n        }\n    }\n\n    /**\n     * Changes the current node\n     * @returns {Promise<boolean>} resolves false if the loading was aborted by another call\n     */\n    setCurrentNode(\n        nodeId: string,\n        options?: VirtualTourTransitionOptions,\n        fromLink?: VirtualTourLink\n    ): Promise<boolean> {\n        if (nodeId === this.state.currentNode?.id) {\n            return Promise.resolve(true);\n        }\n\n        this.viewer.hideError();\n\n        this.state.loadingNode = nodeId;\n\n        const fromNode = this.state.currentNode;\n        const fromLinkPosition = fromNode && fromLink ? this.__getLinkPosition(fromNode, fromLink) : null;\n\n        // if this node is already preloading, wait for it\n        return Promise.resolve(this.state.preload[nodeId])\n            .then(() => {\n                if (this.state.loadingNode !== nodeId) {\n                    throw utils.getAbortError();\n                }\n\n                return this.datasource.loadNode(nodeId);\n            })\n            .then((node) => {\n                if (this.state.loadingNode !== nodeId) {\n                    throw utils.getAbortError();\n                }\n\n                const transitionOptions: VirtualTourTransitionOptions = {\n                    ...getConfig.defaults.transitionOptions,\n                    rotateTo: fromLinkPosition,\n                    ...(typeof this.config.transitionOptions === 'function'\n                        ? this.config.transitionOptions(node, fromNode, fromLink)\n                        : this.config.transitionOptions),\n                    ...options,\n                };\n\n                if (transitionOptions.rotation && !transitionOptions.fadeIn) {\n                    return this.viewer\n                        .animate({\n                            ...transitionOptions.rotateTo,\n                            speed: transitionOptions.speed,\n                        })\n                        .then(() => [node, transitionOptions] as [VirtualTourNode, VirtualTourTransitionOptions]);\n                } else {\n                    return Promise.resolve([node, transitionOptions] as [VirtualTourNode, VirtualTourTransitionOptions]);\n                }\n            })\n            .then(([node, transitionOptions]) => {\n                if (this.state.loadingNode !== nodeId) {\n                    throw utils.getAbortError();\n                }\n\n                if (transitionOptions.showLoader) {\n                    this.viewer.loader.show();\n                }\n\n                this.state.currentNode = node;\n\n                if (this.state.currentTooltip) {\n                    this.state.currentTooltip.hide();\n                    this.state.currentTooltip = null;\n                }\n\n                this.arrowsRenderer?.clearArrows();\n                if (this.gallery?.config.hideOnClick) {\n                    this.gallery.hide();\n                }\n                this.markers?.clearMarkers();\n                this.compass?.clearHotspots();\n                this.map?.minimize();\n                this.plan?.minimize();\n\n                return this.viewer\n                    .setPanorama(node.panorama, {\n                        caption: node.caption,\n                        description: node.description,\n                        panoData: node.panoData,\n                        sphereCorrection: node.sphereCorrection,\n                        transition: !transitionOptions.fadeIn ? false : transitionOptions.rotation ? true : 'fade-only',\n                        showLoader: transitionOptions.showLoader,\n                        speed: transitionOptions.speed,\n                        position: transitionOptions.rotateTo,\n                        zoom: transitionOptions.zoomTo,\n                    })\n                    .then((completed) => {\n                        if (!completed) {\n                            throw utils.getAbortError();\n                        }\n                    });\n            })\n            .then(() => {\n                if (this.state.loadingNode !== nodeId) {\n                    throw utils.getAbortError();\n                }\n\n                const node = this.state.currentNode;\n\n                if (this.map) {\n                    const center = this.__getNodeMapPosition(node);\n                    this.map.setCenter(center);\n                }\n\n                this.plan?.setCoordinates(node.gps);\n\n                if (node.markers) {\n                    this.__addNodeMarkers(node);\n                }\n\n                this.__renderLinks(node);\n                this.__preload(node);\n\n                this.state.loadingNode = null;\n\n                this.dispatchEvent(\n                    new NodeChangedEvent(node, {\n                        fromNode,\n                        fromLink,\n                        fromLinkPosition,\n                    })\n                );\n\n                return true;\n            })\n            .catch((err) => {\n                if (utils.isAbortError(err)) {\n                    return false;\n                }\n\n                this.viewer.showError(this.viewer.config.lang.loadError);\n\n                this.viewer.loader.hide();\n                this.viewer.navbar.setCaption('');\n\n                this.state.loadingNode = null;\n\n                throw err;\n            });\n    }\n\n    /**\n     * Adds the links for the node\n     */\n    private __renderLinks(node: VirtualTourNode) {\n        const positions: Position[] = [];\n\n        let minDist = Number.POSITIVE_INFINITY;\n        let maxDist = Number.NEGATIVE_INFINITY;\n        const linksDist: Record<string, number> = {};\n\n        if (this.isGps) {\n            node.links.forEach((link) => {\n                const dist = gpsDistance(node.gps, link.gps);\n                linksDist[link.nodeId] = dist;\n                minDist = Math.min(dist, minDist);\n                maxDist = Math.max(dist, maxDist);\n            });\n        }\n\n        node.links.forEach((link) => {\n            const position = this.__getLinkPosition(node, link);\n            position.yaw += link.linkOffset?.yaw ?? 0;\n            position.pitch += link.linkOffset?.pitch ?? 0;\n            positions.push(position);\n\n            if (this.is3D) {\n                let depth = 1;\n                if (!utils.isNil(link.linkOffset?.depth)) {\n                    depth = link.linkOffset.depth;\n                } else if (this.isGps && minDist !== maxDist) {\n                    depth = MathUtils.mapLinear(linksDist[link.nodeId], minDist, maxDist, 0.5, 1.5);\n                }\n                this.arrowsRenderer.addArrow(link, position, depth);\n            } else {\n                if (this.isGps) {\n                    position.pitch += this.config.markerPitchOffset;\n                }\n\n                const config: MarkerConfig | VirtualTourMarkerStyle = {\n                    ...this.config.markerStyle,\n                    ...link.markerStyle,\n                    position: position,\n                    id: LINK_ID + link.nodeId,\n                    tooltip: { ...LOADING_TOOLTIP },\n                    visible: true,\n                    hideList: true,\n                    data: { [LINK_DATA]: link },\n                };\n\n                if (typeof config.element === 'function') {\n                    config.element = config.element(link);\n                }\n\n                this.markers.addMarker(config as any, false);\n            }\n        });\n\n        if (this.is3D) {\n            this.viewer.needsUpdate();\n        } else {\n            this.markers.renderMarkers();\n        }\n\n        if (this.config.linksOnCompass && this.compass) {\n            this.compass.setHotspots(positions);\n        }\n    }\n\n    /**\n     * Computes the marker position for a link\n     */\n    private __getLinkPosition(node: VirtualTourNode, link: VirtualTourLink): Position {\n        if (this.isGps) {\n            return gpsToSpherical(node.gps, link.gps);\n        } else {\n            return this.viewer.dataHelper.cleanPosition(link.position);\n        }\n    }\n\n    /**\n     * Returns the complete tootlip content for a node\n     */\n    private async __getTooltipContent(link: VirtualTourLink): Promise<string> {\n        const node = await this.datasource.loadNode(link.nodeId);\n        const elements: string[] = [];\n\n        if (node.name || node.thumbnail || node.caption) {\n            if (node.name) {\n                elements.push(`<h3>${node.name}</h3>`);\n            }\n            if (node.thumbnail) {\n                elements.push(`<img src=\"${node.thumbnail}\">`);\n            }\n            if (node.caption) {\n                elements.push(`<p>${node.caption}</p>`);\n            }\n        }\n\n        let content = elements.join('');\n        if (this.config.getLinkTooltip) {\n            content = this.config.getLinkTooltip(content, link, node);\n        }\n        if (!content) {\n            content = node.id;\n        }\n        return content;\n    }\n\n    private __onEnterMarker(marker: Marker, link: VirtualTourLink) {\n        this.__getTooltipContent(link).then((content) => {\n            this.markers.updateMarker({\n                id: marker.id,\n                tooltip: {\n                    className: 'psv-virtual-tour-tooltip',\n                    content: content,\n                },\n            });\n        });\n    }\n\n    private __onEnterObject(mesh: Mesh, viewerPoint: Point) {\n        const link: VirtualTourLink = mesh.userData[LINK_DATA];\n\n        setMeshColor(mesh as any, link.arrowStyle?.hoverColor || this.config.arrowStyle.hoverColor);\n\n        this.state.currentTooltip = this.viewer.createTooltip({\n            ...LOADING_TOOLTIP,\n            left: viewerPoint.x,\n            top: viewerPoint.y,\n            box: {\n                // separate the tooltip from the cursor\n                width: 20,\n                height: 20,\n            },\n        }),\n\n        this.__getTooltipContent(link).then((content) => {\n            this.state.currentTooltip.update(content);\n        });\n\n        this.map?.setActiveHotspot(LINK_ID + link.nodeId);\n        this.plan?.setActiveHotspot(LINK_ID + link.nodeId);\n\n        this.viewer.needsUpdate();\n        this.viewer.setCursor('pointer');\n\n        this.dispatchEvent(new EnterArrowEvent(link, this.state.currentNode));\n    }\n\n    private __onHoverObject(viewerPoint: Point) {\n        if (this.state.currentTooltip) {\n            this.state.currentTooltip.move({\n                left: viewerPoint.x,\n                top: viewerPoint.y,\n            });\n        }\n    }\n\n    private __onLeaveObject(mesh: Mesh) {\n        const link = mesh.userData[LINK_DATA];\n\n        setMeshColor(mesh as any, link.arrowStyle?.color || this.config.arrowStyle.color);\n\n        if (this.state.currentTooltip) {\n            this.state.currentTooltip.hide();\n            this.state.currentTooltip = null;\n        }\n\n        this.map?.setActiveHotspot(null);\n        this.plan?.setActiveHotspot(null);\n\n        this.viewer.needsUpdate();\n        this.viewer.setCursor(null);\n\n        this.dispatchEvent(new LeaveArrowEvent(link, this.state.currentNode));\n    }\n\n    /**\n     * Manage the preload of the linked panoramas\n     */\n    private __preload(node: VirtualTourNode) {\n        if (!this.config.preload) {\n            return;\n        }\n\n        this.state.preload[node.id] = true;\n\n        this.state.currentNode.links\n            .filter((link) => !this.state.preload[link.nodeId])\n            .filter((link) => {\n                if (typeof this.config.preload === 'function') {\n                    return this.config.preload(this.state.currentNode, link);\n                } else {\n                    return true;\n                }\n            })\n            .forEach((link) => {\n                this.state.preload[link.nodeId] = this.datasource\n                    .loadNode(link.nodeId)\n                    .then((linkNode) => {\n                        return this.viewer.textureLoader.preloadPanorama(linkNode.panorama);\n                    })\n                    .then(() => {\n                        this.state.preload[link.nodeId] = true;\n                    })\n                    .catch(() => {\n                        delete this.state.preload[link.nodeId];\n                    });\n            });\n    }\n\n    /**\n     * Changes the markers to the ones defined on the node\n     */\n    private __addNodeMarkers(node: VirtualTourNode) {\n        if (this.markers) {\n            this.markers.setMarkers(\n                node.markers.map((marker) => {\n                    if (marker.gps && this.isGps) {\n                        marker.position = gpsToSpherical(node.gps, marker.gps);\n                        if (marker.data?.['map']) {\n                            Object.assign(marker.data['map'], this.__getGpsMapPosition(marker.gps));\n                        }\n                        if (marker.data?.['plan']) {\n                            marker.data['plan'].coordinates = marker.gps;\n                        }\n                    }\n                    return marker;\n                })\n            );\n        } else {\n            utils.logWarn(`Node ${node.id} markers ignored because the plugin is not loaded.`);\n        }\n    }\n\n    /**\n     * Gets the position of a node on the map, if applicable\n     */\n    private __getNodeMapPosition(node: VirtualTourNode): Point {\n        const fromGps = this.__getGpsMapPosition(node.gps);\n        if (fromGps) {\n            return fromGps;\n        } else if (node.map) {\n            return { x: node.map.x, y: node.map.y };\n        } else {\n            return null;\n        }\n    }\n\n    /**\n     * Gets a gps position on the map\n     */\n    private __getGpsMapPosition(gps: GpsPosition): Point {\n        const map = this.config.map;\n        if (this.isGps && map.extent && map.size) {\n            return {\n                x: MathUtils.mapLinear(gps[0], map.extent[0], map.extent[2], 0, map.size.width),\n                y: MathUtils.mapLinear(gps[1], map.extent[1], map.extent[3], 0, map.size.height),\n            };\n        } else {\n            return null;\n        }\n    }\n}\n","import { CONSTANTS, CustomRenderer, Position, Viewer } from '@photo-sphere-viewer/core';\nimport {\n    AmbientLight,\n    BackSide,\n    Camera,\n    Group,\n    Intersection,\n    MathUtils,\n    Mesh,\n    MeshBasicMaterial,\n    MeshLambertMaterial,\n    PerspectiveCamera,\n    PointLight,\n    REVISION,\n    Raycaster,\n    Scene,\n    Vector2,\n    WebGLRenderer,\n} from 'three';\nimport type { VirtualTourPlugin } from './VirtualTourPlugin';\nimport { ARROW_GEOM, ARROW_OUTLINE_GEOM, LINK_DATA } from './constants';\nimport { VirtualTourLink } from './model';\nimport { setMeshColor } from './utils';\n\n// https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733\nconst LIGHT_INTENSITY = parseInt(REVISION) >= 155 ? Math.PI : 1;\n\n/**\n * Custom renderer to draw the arrows atop the panorama, without being impacted by the zoom level\n */\nexport class ArrowsRenderer implements CustomRenderer {\n    private renderer: WebGLRenderer;\n\n    private readonly camera: PerspectiveCamera;\n    private readonly scene: Scene;\n    private readonly group: Group;\n\n    constructor(\n        private viewer: Viewer,\n        private plugin: VirtualTourPlugin\n    ) {\n        this.camera = new PerspectiveCamera(50, 16 / 9, 0.1, 2 * CONSTANTS.SPHERE_RADIUS);\n        this.scene = new Scene();\n\n        const ambientLight = new AmbientLight(0xffffff, LIGHT_INTENSITY);\n        this.scene.add(ambientLight);\n\n        const localLight = new PointLight(0xffffff, LIGHT_INTENSITY, 0, 0);\n        localLight.position.set(0, 0, 0);\n        this.scene.add(localLight);\n\n        this.group = new Group();\n        this.scene.add(this.group);\n\n        // position the arrows slighly above/bellow the bottom/top of the viewer\n        let positionY = CONSTANTS.SPHERE_RADIUS * Math.atan(MathUtils.degToRad(this.camera.fov / 2)) - 1.5;\n        if (this.plugin.config.arrowPosition === 'bottom') {\n            positionY *= -1;\n        }\n        this.group.position.set(0, positionY, 0);\n    }\n\n    destroy() {\n        delete this.viewer;\n        delete this.plugin;\n        delete this.renderer;\n    }\n\n    withRenderer(renderer: WebGLRenderer) {\n        this.renderer = renderer;\n        return this;\n    }\n\n    updateCamera() {\n        this.camera.aspect = this.viewer.state.aspect;\n\n        // the camera rotate around the center of the sphere\n        this.camera.position.copy(this.viewer.state.direction).negate();\n        this.camera.lookAt(0, 0, 0);\n\n        this.camera.updateProjectionMatrix();\n    }\n\n    render(scene: Scene, camera: Camera) {\n        this.renderer.render(scene, camera);\n        this.renderer.autoClear = false;\n        this.renderer.clearDepth();\n        this.renderer.render(this.scene, this.camera);\n        this.renderer.autoClear = true;\n    }\n\n    getIntersections(raycaster: Raycaster, vector: Vector2): Array<Intersection<Mesh>> {\n        raycaster.setFromCamera(vector, this.camera);\n\n        return raycaster.intersectObjects(this.group.children);\n    }\n\n    clearArrows() {\n        this.group.clear();\n    }\n\n    addArrow(link: VirtualTourLink, position: Position, depth: number) {\n        const size = link.arrowStyle?.size || this.plugin.config.arrowStyle.size;\n\n        const mesh = new Mesh(ARROW_GEOM, new MeshLambertMaterial());\n        mesh.userData = { [LINK_DATA]: link };\n        mesh.renderOrder = 1000 + this.group.children.length;\n        mesh.scale.multiplyScalar(size);\n        mesh.rotation.order = 'YXZ';\n        mesh.rotateY(-position.yaw);\n        // 2 = base distance to center\n        this.viewer.dataHelper.sphericalCoordsToVector3(\n            { yaw: position.yaw, pitch: 0 },\n            mesh.position,\n            2 * depth * size\n        );\n\n        const outlineMesh = new Mesh(ARROW_OUTLINE_GEOM, new MeshBasicMaterial({ side: BackSide }));\n        outlineMesh.scale.copy(mesh.scale);\n        outlineMesh.position.copy(mesh.position);\n        outlineMesh.rotation.copy(mesh.rotation);\n\n        setMeshColor(mesh, link.arrowStyle?.color || this.plugin.config.arrowStyle.color);\n        setMeshColor(outlineMesh, link.arrowStyle?.outlineColor || this.plugin.config.arrowStyle.outlineColor);\n\n        this.group.add(mesh);\n        this.group.add(outlineMesh);\n\n        // arrows are renderer last and on top of their outline\n        // the depth buffer must be cleared only once\n        mesh.onBeforeRender = function (renderer) {\n            if (this.renderOrder === 1000) {\n                renderer.clearDepth();\n            }\n        };\n    }\n}\n","import { ObjectLoader } from 'three';\nimport { VirtualTourArrowStyle, VirtualTourMarkerStyle } from './model';\nimport arrowIconSvg from './arrow.svg';\nimport arrowGeometryJson from './models/arrow.json';\nimport arrowOutlineGeometryJson from './models/arrow_outline.json';\n\nexport const LINK_DATA = 'tourLink';\nexport const LINK_ID = '__tour-link__';\n\nexport const LOADING_TOOLTIP = {\n    className: 'psv-virtual-tour-tooltip',\n    content: `<div class=\"psv-virtual-tour-loader\"><div></div><div></div><div></div></div>`,\n};\n\n/**\n * Default style of the link marker\n */\nexport const DEFAULT_MARKER: VirtualTourMarkerStyle = {\n    element: () => {\n        const button = document.createElement('button');\n        button.className = 'psv-virtual-tour-link';\n        button.innerHTML = arrowIconSvg;\n        return button;\n    },\n    size: { width: 80, height: 80 },\n};\n\n/**\n * Default style of the link arrow\n */\nexport const DEFAULT_ARROW: VirtualTourArrowStyle = {\n    color: '#aaaaaa',\n    hoverColor: '#aa5500',\n    outlineColor: '#000000',\n    size: 1,\n};\n\nexport const { ARROW_GEOM, ARROW_OUTLINE_GEOM } = (() => {\n    const loader = new ObjectLoader();\n    const geometries = loader.parseGeometries([arrowGeometryJson, arrowOutlineGeometryJson]);\n    const arrow = geometries[arrowGeometryJson.uuid];\n    const arrowOutline = geometries[arrowOutlineGeometryJson.uuid];\n    const scale = 0.03;\n    const rot = Math.PI / 2;\n    arrow.scale(scale, scale, scale);\n    arrow.rotateX(rot);\n    arrowOutline.scale(scale, scale, scale);\n    arrowOutline.rotateX(rot);\n    return { ARROW_GEOM: arrow, ARROW_OUTLINE_GEOM: arrowOutline };\n})();\n","<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\">\n    <path fill-rule=\"even-odd\" fill=\"currentColor\" d=\"\n        M50,50 m45,0\n        a45,45 0 1,0 -90,0\n        a45,45 0 1,0  90,0\n\n        M50,50 m38,0\n        a38,38 0 0,1 -76,0\n        a38,38 0 0,1  76,0\n\n        M50,50 m30,0\n        a30,30 0 1,0 -60,0\n        a30,30 0 1,0  60,0\n        \n        M50,40 m2.5,-2.5\n        l17.5,17.5\n        a 2.5,2.5 0 0 1 -5,5\n        l-15,-15\n        l-15,15\n        a 2.5,2.5 0 0 1 -5,-5\n        l17.5,-17.5\n        a 3.5,3.5 0 0 1 5,0\n    \"/>\n</svg>","{\n  \"metadata\": {\n    \"version\": 4.5,\n    \"type\": \"BufferGeometry\",\n    \"generator\": \"BufferGeometry.toJSON\"\n  },\n  \"uuid\": \"8B1A6E5B-A7CC-4471-9CA0-BD64D80ABB79\",\n  \"type\": \"BufferGeometry\",\n  \"data\": {\n    \"attributes\": {\n      \"position\": {\n        \"itemSize\": 3,\n        \"type\": \"Float32Array\",\n        \"array\": [-25,-15,-2.5,0,0,-2.5,0,-5,-2.5,0,-5,-2.5,0,0,-2.5,25,-15,-2.5,0,-5,-2.5,25,-15,-2.5,25,-20,-2.5,0,-5,-2.5,-25,-20,-2.5,-25,-15,-2.5,25,-15,2.5,25,-20,2.5,25,-15,-2.5,25,-15,-2.5,25,-20,2.5,25,-20,-2.5,25,-20,2.5,0,-5,2.5,25,-20,-2.5,25,-20,-2.5,0,-5,2.5,0,-5,-2.5,0,-5,2.5,-25,-20,2.5,0,-5,-2.5,0,-5,-2.5,-25,-20,2.5,-25,-20,-2.5,-25,-20,2.5,-25,-15,2.5,-25,-20,-2.5,-25,-20,-2.5,-25,-15,2.5,-25,-15,-2.5,-25,-15,2.5,0,0,2.5,-25,-15,-2.5,-25,-15,-2.5,0,0,2.5,0,0,-2.5,0,0,2.5,25,-15,2.5,0,0,-2.5,0,0,-2.5,25,-15,2.5,25,-15,-2.5,25,-20,2.5,25,-15,2.5,0,-5,2.5,0,-5,2.5,25,-15,2.5,0,0,2.5,0,-5,2.5,0,0,2.5,-25,-15,2.5,-25,-15,2.5,-25,-20,2.5,0,-5,2.5],\n        \"normalized\": false\n      },\n      \"normal\": {\n        \"itemSize\": 3,\n        \"type\": \"Float32Array\",\n        \"array\": [0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-0.514495,-0.857492,0,-0.514495,-0.857492,0,-0.514495,-0.857492,0,-0.514495,-0.857492,0,-0.514495,-0.857492,0,-0.514495,-0.857492,0,0.514495,-0.857492,0,0.514495,-0.857492,0,0.514495,-0.857492,0,0.514495,-0.857492,0,0.514495,-0.857492,0,0.514495,-0.857492,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-0.514495,0.857492,0,-0.514495,0.857492,0,-0.514495,0.857492,0,-0.514495,0.857492,0,-0.514495,0.857492,0,-0.514495,0.857492,0,0.514495,0.857492,0,0.514495,0.857492,0,0.514495,0.857492,0,0.514495,0.857492,0,0.514495,0.857492,0,0.514495,0.857492,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1],\n        \"normalized\": false\n      }\n    },\n    \"boundingSphere\": {\n      \"center\": [0,-10,0],\n      \"radius\": 27.041634\n    }\n  }\n}\n","{\n  \"metadata\": {\n    \"version\": 4.5,\n    \"type\": \"BufferGeometry\",\n    \"generator\": \"BufferGeometry.toJSON\"\n  },\n  \"uuid\": \"B12A1453-6E56-40AC-840B-BA7DF5DB9E2A\",\n  \"type\": \"BufferGeometry\",\n  \"data\": {\n    \"attributes\": {\n      \"position\": {\n        \"itemSize\": 3,\n        \"type\": \"Float32Array\",\n        \"array\": [-26,-21.766189,-3.5,-26,-14.433809,-3.5,0,-6.166190,-3.5,0,-6.166190,-3.5,-26,-14.433809,-3.5,0,1.166190,-3.5,0,-6.166190,-3.5,0,1.166190,-3.5,26,-14.433810,-3.5,26,-14.433810,-3.5,26,-21.766191,-3.5,0,-6.166190,-3.5,-26,-14.433809,3.5,0,1.166190,3.5,-26,-14.433809,-3.5,-26,-14.433809,-3.5,0,1.166190,3.5,0,1.166190,-3.5,0,1.166190,3.5,26,-14.433810,3.5,0,1.166190,-3.5,0,1.166190,-3.5,26,-14.433810,3.5,26,-14.433810,-3.5,26,-14.433810,3.5,26,-21.766191,3.5,26,-14.433810,-3.5,26,-14.433810,-3.5,26,-21.766191,3.5,26,-21.766191,-3.5,26,-21.766191,3.5,0,-6.166190,3.5,26,-21.766191,-3.5,26,-21.766191,-3.5,0,-6.166190,3.5,0,-6.166190,-3.5,0,-6.166190,3.5,-26,-21.766189,3.5,0,-6.166190,-3.5,0,-6.166190,-3.5,-26,-21.766189,3.5,-26,-21.766189,-3.5,-26,-21.766189,3.5,-26,-14.433809,3.5,-26,-21.766189,-3.5,-26,-21.766189,-3.5,-26,-14.433809,3.5,-26,-14.433809,-3.5,-26,-21.766189,3.5,0,-6.166190,3.5,-26,-14.433809,3.5,-26,-14.433809,3.5,0,-6.166190,3.5,0,1.166190,3.5,0,1.166190,3.5,0,-6.166190,3.5,26,-14.433810,3.5,26,-14.433810,3.5,0,-6.166190,3.5,26,-21.766191,3.5],\n        \"normalized\": false\n      },\n      \"normal\": {\n        \"itemSize\": 3,\n        \"type\": \"Float32Array\",\n        \"array\": [0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,-0.514495,0.857492,0,-0.514495,0.857492,0,-0.514495,0.857492,0,-0.514495,0.857492,0,-0.514495,0.857492,0,-0.514495,0.857492,0,0.514495,0.857492,0,0.514495,0.857492,0,0.514495,0.857492,0,0.514495,0.857492,0,0.514495,0.857492,0,0.514495,0.857492,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-0.514495,-0.857492,0,-0.514495,-0.857492,0,-0.514495,-0.857492,0,-0.514495,-0.857492,0,-0.514495,-0.857492,0,-0.514495,-0.857492,0,0.514495,-0.857492,0,0.514495,-0.857492,0,0.514495,-0.857492,0,0.514495,-0.857492,0,0.514495,-0.857492,0,0.514495,-0.857492,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1],\n        \"normalized\": false\n      }\n    },\n    \"boundingSphere\": {\n      \"center\": [0,-10.300000,0],\n      \"radius\": 28.630814\n    }\n  }\n}\n","import { Position, utils } from '@photo-sphere-viewer/core';\nimport { BufferGeometry, MathUtils, Mesh, MeshBasicMaterial, MeshLambertMaterial } from 'three';\nimport { GpsPosition } from './model';\n\n/**\n * Changes the color of a mesh\n */\nexport function setMeshColor(mesh: Mesh<BufferGeometry, MeshBasicMaterial | MeshLambertMaterial>, color: string) {\n    mesh.material.color.set(color);\n}\n\n/**\n * Returns the distance between two GPS points\n */\nexport function gpsDistance(gps1: GpsPosition, gps2: GpsPosition): number {\n    return distance(gpsDegToRad(gps1), gpsDegToRad(gps2));\n}\n\n/**\n * Returns the difference between two WS84 GPS points as yaw+pitch on the viewer\n */\nexport function gpsToSpherical(gps1: GpsPosition, gps2: GpsPosition): Position {\n    const p1 = gpsDegToRad(gps1);\n    const p2 = gpsDegToRad(gps2);\n    const h1 = gps1[2] ?? 0;\n    const h2 = gps2[2] ?? 0;\n\n    let pitch = 0;\n    if (h1 !== h2) {\n        pitch = Math.atan((h2 - h1) / distance(p1, p2));\n    }\n\n    const yaw = bearing(p1, p2);\n\n    return { yaw, pitch };\n}\n\nfunction gpsDegToRad(gps: GpsPosition): [number, number] {\n    return [MathUtils.degToRad(gps[0]), MathUtils.degToRad(gps[1])];\n}\n\n/**\n * Returns the distance between two GPS points\n */\nfunction distance(p1: [number, number], p2: [number, number]): number {\n    return utils.greatArcDistance(p1, p2) * 6371e3;\n}\n\n/**\n * Returns the bearing between two GPS points\n * @link http://www.movable-type.co.uk/scripts/latlong.html\n */\nfunction bearing(p1: [number, number], p2: [number, number]): number {\n    const [long1, lat1] = p1;\n    const [long2, lat2] = p2;\n\n    const y = Math.sin(long2 - long1) * Math.cos(lat2);\n    const x = Math.cos(lat1) * Math.sin(lat2) - Math.sin(lat1) * Math.cos(lat2) * Math.cos(long2 - long1);\n    return Math.atan2(y, x);\n}\n","import { PSVError, utils } from '@photo-sphere-viewer/core';\nimport { VirtualTourNode } from '../model';\nimport { AbstractDatasource } from './AbstractDataSource';\n\nexport class ClientSideDatasource extends AbstractDatasource {\n    loadNode(nodeId: string) {\n        if (this.nodes[nodeId]) {\n            return Promise.resolve(this.nodes[nodeId]);\n        } else {\n            return Promise.reject(new PSVError(`Node ${nodeId} not found`));\n        }\n    }\n\n    setNodes(rawNodes: VirtualTourNode[]) {\n        if (!rawNodes?.length) {\n            throw new PSVError('No nodes provided');\n        }\n\n        const nodes: Record<string, VirtualTourNode> = {};\n        const linkedNodes: Record<string, boolean> = {};\n\n        rawNodes.forEach((node) => {\n            this.checkNode(node);\n\n            if (nodes[node.id]) {\n                throw new PSVError(`Duplicate node ${node.id}`);\n            }\n            if (!node.links) {\n                utils.logWarn(`Node ${node.id} has no links`);\n                node.links = [];\n            }\n\n            nodes[node.id] = node;\n        });\n\n        rawNodes.forEach((node) => {\n            node.links.forEach((link) => {\n                if (!nodes[link.nodeId]) {\n                    throw new PSVError(`Target node ${link.nodeId} of node ${node.id} does not exists`);\n                }\n\n                link.gps = link.gps || nodes[link.nodeId].gps;\n\n                this.checkLink(node, link);\n\n                linkedNodes[link.nodeId] = true;\n            });\n        });\n\n        rawNodes.forEach((node) => {\n            if (!linkedNodes[node.id]) {\n                utils.logWarn(`Node ${node.id} is never linked to`);\n            }\n        });\n\n        this.nodes = nodes;\n    }\n}\n","import type { Viewer } from '@photo-sphere-viewer/core';\nimport { PSVError, utils } from '@photo-sphere-viewer/core';\nimport { VirtualTourLink, VirtualTourNode } from '../model';\nimport type { VirtualTourPlugin } from '../VirtualTourPlugin';\n\nexport abstract class AbstractDatasource {\n    nodes: Record<string, VirtualTourNode> = {};\n\n    constructor(\n        protected readonly plugin: VirtualTourPlugin,\n        protected readonly viewer: Viewer\n    ) {}\n\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    destroy() {}\n\n    /**\n     * @summary Loads a node\n     * @param {string} nodeId\n     * @return {Promise<PSV.plugins.VirtualTourPlugin.Node>}\n     */\n    abstract loadNode(nodeId: string): Promise<VirtualTourNode>;\n\n    /**\n     * Checks the configuration of a node\n     */\n    protected checkNode(node: VirtualTourNode) {\n        if (!node.id) {\n            throw new PSVError('No id given for node');\n        }\n        if (!node.panorama) {\n            throw new PSVError(`No panorama provided for node ${node.id}`);\n        }\n        if ('position' in node) {\n            utils.logWarn('Use the \"gps\" property to configure the GPS position of a virtual node');\n            // @ts-ignore\n            node.gps = node['position'];\n        }\n        if (this.plugin.isGps && !(node.gps?.length >= 2)) {\n            throw new PSVError(`No GPS position provided for node ${node.id}`);\n        }\n        if (!this.plugin.isGps && node.markers?.some((marker) => marker.gps && !marker.position)) {\n            throw new PSVError(`Cannot use GPS positioning for markers in manual mode`);\n        }\n    }\n\n    /**\n     * Checks the configuration of a link\n     */\n    protected checkLink(node: VirtualTourNode, link: VirtualTourLink) {\n        if (!link.nodeId) {\n            throw new PSVError(`Link of node ${node.id} has no target id`);\n        }\n        if (Array.isArray(link.position)) {\n            utils.logWarn('Use the \"gps\" property to configure the GPS position of a virtual link');\n            link.gps = link.position as any;\n            delete link.position;\n        }\n        if (utils.isExtendedPosition(link)) {\n            utils.logWarn('Use the \"position\" property to configure the position of a virtual link');\n            link.position = this.viewer.dataHelper.cleanPosition(link);\n        }\n        if (!this.plugin.isGps && !utils.isExtendedPosition(link.position)) {\n            throw new PSVError(`No position provided for link ${link.nodeId} of node ${node.id}`);\n        }\n        if (this.plugin.isGps && !link.gps) {\n            throw new PSVError(`No GPS position provided for link ${link.nodeId} of node ${node.id}`);\n        }\n    }\n}\n","import type { Viewer } from '@photo-sphere-viewer/core';\nimport { PSVError, utils } from '@photo-sphere-viewer/core';\nimport { VirtualTourPluginConfig } from '../model';\nimport { VirtualTourPlugin } from '../VirtualTourPlugin';\nimport { AbstractDatasource } from './AbstractDataSource';\n\nexport class ServerSideDatasource extends AbstractDatasource {\n    private readonly nodeResolver: VirtualTourPluginConfig['getNode'];\n\n    constructor(plugin: VirtualTourPlugin, viewer: Viewer) {\n        super(plugin, viewer);\n\n        if (!plugin.config.getNode) {\n            throw new PSVError('Missing getNode() option.');\n        }\n\n        this.nodeResolver = plugin.config.getNode;\n    }\n\n    loadNode(nodeId: string) {\n        if (this.nodes[nodeId]) {\n            return Promise.resolve(this.nodes[nodeId]);\n        } else {\n            return Promise.resolve(this.nodeResolver(nodeId)).then((node) => {\n                this.checkNode(node);\n                if (!node.links) {\n                    utils.logWarn(`Node ${node.id} has no links`);\n                    node.links = [];\n                }\n\n                node.links.forEach((link) => {\n                    if (this.nodes[link.nodeId]) {\n                        link.gps = link.gps || this.nodes[link.nodeId].gps;\n                    }\n\n                    this.checkLink(node, link);\n                });\n\n                this.nodes[nodeId] = node;\n                return node;\n            });\n        }\n    }\n}\n"],"mappings":"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","names":["import_core","import_three","import_core","import_three","arrow_default","arrow_default","import_core","import_three","import_core","import_core","import_core"]}